'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = exports.logIn = exports.fetchCourse = undefined;

var _apply = require('babel-runtime/core-js/reflect/apply');

var _apply2 = _interopRequireDefault(_apply);

var _assign = require('babel-runtime/core-js/object/assign');

var _assign2 = _interopRequireDefault(_assign);

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

var _isNan = require('babel-runtime/core-js/number/is-nan');

var _isNan2 = _interopRequireDefault(_isNan);

var _setImmediate2 = require('babel-runtime/core-js/set-immediate');

var _setImmediate3 = _interopRequireDefault(_setImmediate2);

var _isotropicError = require('isotropic-error');

var _isotropicError2 = _interopRequireDefault(_isotropicError);

var _htmlparser = require('htmlparser2');

var _isotropicMake = require('isotropic-make');

var _isotropicMake2 = _interopRequireDefault(_isotropicMake);

var _url = require('url');

var _https = require('https');

var _querystring = require('querystring');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
@class SuperMarioMakerClient
@arg {Object} [config]
@arg {String} [config.csrfTokenHeaderName='X-CSRF-Token']
@arg {Object} [config.gameStyles={sb: 'superMarioBros',sb3: 'superMarioBros3',sbu: 'newSuperMarioBrosU',sw: 'superMarioWorld'}]
@arg {String} [config.lang='en-US']
@arg {String} [config.sessionCookieName='_supermariomakerbookmark_session']
@arg {String} [config.superMarioMakerAuthUrl='https://supermariomakerbookmark.nintendo.net/users/auth/nintendo']
@arg {String} [config.superMarioMakerBookmarkUrl='https://supermariomakerbookmark.nintendo.net']
*/
/**
@module super-mario-maker-client
@author Steven Olmsted <steven.olm@gmail.com>
*/

/**
@callback CourseCallback
@arg {Error} error
@arg {Object} course
*/

/**
@callback ErrorCallback
@arg {Error} error
*/

/**
@callback IncomingMessageCallback
@arg {Error} error
@arg {IncomingMessage} response
*/

/**
@callback SuperMarioMakerClientCallback
@arg {Error} error
@arg {SuperMarioMakerClient} superMarioMakerClient
*/

const _SuperMarioMakerClient = (0, _isotropicMake2.default)({
    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#bookmarkCourse
    @arg {Object} config
    @arg {String} config.courseId
    @arg {String} config.csrfToken
    @arg {ErrorCallback} callbackFunction
    @instance
    @returns {this}
    */

    bookmarkCourse: function bookmarkCourse(_ref, callbackFunction) {
        let courseId = _ref.courseId;
        let csrfToken = _ref.csrfToken;

        if (!this._isLoggedIn) {
            (0, _setImmediate3.default)(callbackFunction, (0, _isotropicError2.default)({
                message: 'Not logged in.'
            }));
            return this;
        }

        return this._request({
            options: {
                headers: {
                    [this._csrfTokenHeaderName]: csrfToken
                },
                method: 'POST'
            },
            url: this._getCourseBookmarkUrl(courseId)
        }, (error, response) => {
            if (error) {
                callbackFunction((0, _isotropicError2.default)({
                    error: error
                }));
            } else if (response.statusCode === 200) {
                callbackFunction();
            } else {
                callbackFunction((0, _isotropicError2.default)({
                    details: {
                        response: response
                    },
                    message: 'Failed to bookmark course.'
                }));
            }
        });
    },

    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#fetchCourse
    @arg {String} courseId
    @arg {CourseCallback} callbackFunction
    @returns {this}
    */
    fetchCourse: function fetchCourse(courseId, callbackFunction) {
        return this._request({
            url: this._getCourseUrl(courseId)
        }, (error, response) => {
            if (error) {
                callbackFunction((0, _isotropicError2.default)({
                    error: error
                }));
                return;
            }

            if (response.statusCode !== 200) {
                callbackFunction((0, _isotropicError2.default)({
                    details: {
                        response: response
                    },
                    message: 'Course request failed.'
                }));
                return;
            }

            let complete,
                currentNode = {
                attributes: {},
                children: [],
                name: 'root',
                text: []
            };

            const completeFunction = (error, course) => {
                if (complete) {
                    return;
                }

                complete = true;

                if (error) {
                    callbackFunction((0, _isotropicError2.default)({
                        error: error,
                        message: 'HTML parse error.'
                    }));
                } else {
                    callbackFunction(null, course);
                }
            },
                  course = {
                courseId: courseId
            },
                  gameStyles = this._gameStyles;

            response.pipe(new _htmlparser.Parser({
                onclosetag: function onclosetag(name) {
                    if (currentNode.name !== name) {
                        completeFunction((0, _isotropicError2.default)({
                            details: {
                                name: name
                            },
                            message: 'Closing tag had no matching open tag.'
                        }));

                        response.unpipe();
                        return;
                    }

                    const className = currentNode.attributes.class,
                          closedNode = currentNode;

                    currentNode = currentNode.parent;

                    if (!className) {
                        return;
                    }

                    if (/(?:^| )clear-rate(?: |$)/.test(className)) {
                        let digits = '';

                        closedNode.children.forEach(childNode => {
                            const className = childNode.attributes.class,
                                  match = className && className.match(/(?:^| )typography-(\d|second)(?: |$)/);

                            if (!match) {
                                return;
                            }

                            if (match[1] === 'second') {
                                digits += '.';
                            } else {
                                digits += match[1];
                            }
                        });

                        if (digits) {
                            course.clearRate = +digits;
                        }
                    } else if (/(?:^| )clear-time(?: |$)/.test(className)) {
                        let digits = '',
                            minutes,
                            seconds;

                        closedNode.children.forEach(childNode => {
                            const className = childNode.attributes.class,
                                  match = className && className.match(/(?:^| )typography-(\d|minute|second)(?: |$)/);

                            if (!match) {
                                return;
                            }

                            if (match[1] === 'minute') {
                                if (digits) {
                                    minutes = +digits;
                                    digits = '';
                                }
                            } else if (match[1] === 'second') {
                                if (digits) {
                                    seconds = +digits;
                                    digits = '';
                                }
                            } else {
                                digits += match[1];
                            }
                        });

                        if (digits || minutes || seconds) {
                            let distance = 0,
                                node = closedNode.parent,
                                worldRecord;

                            const time = (minutes || 0) * 60000 + (seconds || 0) * 1000 + (+digits || 0);

                            while (node && distance < 3) {
                                const className = node.attributes.class;

                                if (className && /(?:^| )fastest-user(?: |$)/.test(className)) {
                                    worldRecord = true;
                                }

                                node = node.parent;
                                distance += 1;
                            }

                            if (worldRecord) {
                                worldRecord = course.worldRecord;

                                if (!worldRecord) {
                                    worldRecord = {};
                                    course.worldRecord = worldRecord;
                                }

                                worldRecord.time = time;
                            } else {
                                course.yourBestTime = time;
                            }
                        }
                    } else if (/(?:^| )course-detail-wrapper(?: |$)/.test(className)) {
                        closedNode.children.forEach(childNode => {
                            const className = childNode.attributes.class;

                            if (!className) {
                                return;
                            }

                            if (/(?:^| )creator(?: |$)/.test(className)) {
                                const findImgSrc = childNode => {
                                    if (childNode.name === 'img' && childNode.attributes.src) {
                                        return childNode.attributes.src;
                                    }

                                    let imgSrc;

                                    childNode.children.some(childNode => {
                                        imgSrc = findImgSrc(childNode);
                                        return imgSrc;
                                    });

                                    return imgSrc;
                                },
                                      imgSrc = findImgSrc(childNode);

                                if (!imgSrc) {
                                    return;
                                }

                                let creator = course.creator;

                                if (!creator) {
                                    creator = {};
                                    course.creator = creator;
                                }

                                creator.miiIconUrl = imgSrc;
                            } else if (/(?:^| )creator-info(?: |$)/.test(className)) {
                                let creator = course.creator;

                                if (!creator) {
                                    creator = {};
                                    course.creator = creator;
                                }

                                childNode.children.forEach(childNode => {
                                    const className = childNode.attributes.class;

                                    if (!className) {
                                        return;
                                    }

                                    if (/(?:^| )flag(?: |$)/.test(className)) {
                                        const country = className.split(' ').filter(className => className !== 'flag')[0];

                                        if (country) {
                                            creator.country = country;
                                        }
                                    } else if (/(?:^| )medals(?: |$)/.test(className)) {
                                        let match = className.match(/(?:^| )common_icon_coin(\d+)(?: |$)/);

                                        match = match && match[1];

                                        if (match) {
                                            if (match === '11') {
                                                let digits = '';

                                                childNode.children.forEach(childNode => {
                                                    const className = childNode.attributes.class,
                                                          match = className && className.match(/(?:^| )typography-(\d)(?: |$)/);

                                                    if (match) {
                                                        digits += match[1];
                                                    }
                                                });

                                                if (digits) {
                                                    creator.medals = +digits;
                                                }
                                            } else {
                                                creator.medals = +match;
                                            }
                                        }
                                    } else if (/(?:^| )name(?: |$)/.test(className)) {
                                        const text = childNode.text[0];

                                        if (text) {
                                            creator.miiName = text;
                                        }
                                    }
                                });
                            }
                        });
                    } else if (/(?:^| )course-header(?: |$)/.test(className) && closedNode.text.length) {
                        const difficulty = closedNode.text.join('');

                        course.difficulty = difficulty.charAt(0).toLowerCase() + difficulty.substr(1).replace(/ /g, '');
                    } else if (/(?:^| )course-tag(?: |$)/.test(className) && closedNode.text.length) {
                        const tag = closedNode.text.join('');

                        if (tag && tag !== '---') {
                            course.tag = tag;
                        }
                    } else if (/(?:^| )course-title(?: |$)/.test(className) && closedNode.text.length) {
                        course.title = closedNode.text.join('');
                    } else if (/(?:^| )created_at(?: |$)/.test(className) && closedNode.text.length) {
                        const createdAt = closedNode.text.join(''),
                              match = createdAt.match(/^(\d+) (day|hour)s? ago$/);

                        course.createdAt = createdAt;

                        if (match) {
                            let millisecondsAgo;

                            switch (match[2]) {
                                case 'day':
                                    millisecondsAgo = 86400000;
                                    break;
                                case 'hour':
                                    millisecondsAgo = 3600000;
                                    break;
                                default:
                                    return;
                            }

                            course.uploadDate = new Date(new Date().getTime() - match[1] * millisecondsAgo);
                        } else {
                            const uploadDate = new Date(createdAt);

                            if (!(0, _isNan2.default)(uploadDate.getTime())) {
                                course.uploadDate = uploadDate;
                            }
                        }
                    } else if (/(?:^| )liked-count(?: |$)/.test(className)) {
                        let digits = '';

                        closedNode.children.forEach(childNode => {
                            const className = childNode.attributes.class,
                                  match = className && className.match(/(?:^| )typography-(\d)(?: |$)/);

                            if (match) {
                                digits += match[1];
                            }
                        });

                        if (digits) {
                            course.stars = +digits;
                        }
                    } else if (/(?:^| )played-count(?: |$)/.test(className)) {
                        let digits = '';

                        closedNode.children.forEach(childNode => {
                            const className = childNode.attributes.class,
                                  match = className && className.match(/(?:^| )typography-(\d)(?: |$)/);

                            if (match) {
                                digits += match[1];
                            }
                        });

                        if (digits) {
                            course.players = +digits;
                        }
                    } else if (/(?:^| )shared-count(?: |$)/.test(className)) {
                        let digits = '';

                        closedNode.children.forEach(childNode => {
                            const className = childNode.attributes.class,
                                  match = className && className.match(/(?:^| )typography-(\d)(?: |$)/);

                            if (match) {
                                digits += match[1];
                            }
                        });

                        if (digits) {
                            course.tweets = +digits;
                        }
                    } else if (/(?:^| )tried-count(?: |$)/.test(className)) {
                        let digits = '';

                        closedNode.children.forEach(childNode => {
                            const className = childNode.attributes.class,
                                  match = className && className.match(/(?:^| )typography-(\d|slash)(?: |$)/);

                            if (!match) {
                                return;
                            }

                            if (match[1] === 'slash') {
                                if (digits) {
                                    course.clears = +digits;
                                    digits = '';
                                }
                            } else {
                                digits += match[1];
                            }
                        });

                        if (digits) {
                            course.attempts = +digits;
                        }
                    } else if (/(?:^| )user-wrapper(?: |$)/.test(className)) {
                        const player = {};

                        closedNode.children.forEach(childNode => {
                            const className = childNode.attributes.class;

                            if (!className) {
                                return;
                            }

                            if (/(?:^| )mii-wrapper(?: |$)/.test(className)) {
                                const findImgSrc = childNode => {
                                    if (childNode.name === 'img' && childNode.attributes.src) {
                                        return childNode.attributes.src;
                                    }

                                    let imgSrc;

                                    childNode.children.some(childNode => {
                                        imgSrc = findImgSrc(childNode);
                                        return imgSrc;
                                    });

                                    return imgSrc;
                                },
                                      imgSrc = findImgSrc(childNode);

                                if (imgSrc) {
                                    player.miiIconUrl = imgSrc;
                                }
                            } else if (/(?:^| )user-info(?: |$)/.test(className)) {
                                childNode.children.forEach(childNode => {
                                    const className = childNode.attributes.class;

                                    if (!className) {
                                        return;
                                    }

                                    if (/(?:^| )flag(?: |$)/.test(className)) {
                                        const country = className.split(' ').filter(className => className !== 'flag')[0];

                                        if (country) {
                                            player.country = country;
                                        }
                                    } else if (/(?:^| )name(?: |$)/.test(className)) {
                                        const text = childNode.text[0];

                                        if (text) {
                                            player.miiName = text;
                                        }
                                    }
                                });
                            }
                        });

                        if (!(0, _keys2.default)(player).length) {
                            return;
                        }

                        let distance = 0,
                            node = closedNode.parent;

                        while (node && distance < 3) {
                            const className = node.attributes.class;

                            if (className) {
                                if (/(?:^| )cleared-body(?: |$)/.test(className)) {
                                    let clearedBy = course.clearedBy;

                                    if (!clearedBy) {
                                        clearedBy = [];
                                        course.clearedBy = clearedBy;
                                    }

                                    clearedBy.push(player);
                                    return;
                                }

                                if (/(?:^| )fastest-user(?: |$)/.test(className)) {
                                    let worldRecord = course.worldRecord;

                                    if (!worldRecord) {
                                        worldRecord = {};
                                        course.worldRecord = worldRecord;
                                    }

                                    worldRecord.player = player;
                                    return;
                                }

                                if (/(?:^| )first-user(?: |$)/.test(className)) {
                                    course.firstClearBy = player;
                                    return;
                                }

                                if (/(?:^| )liked-body(?: |$)/.test(className)) {
                                    let starredBy = course.starredBy;

                                    if (!starredBy) {
                                        starredBy = [];
                                        course.starredBy = starredBy;
                                    }

                                    starredBy.push(player);
                                    return;
                                }

                                if (/(?:^| )played-body(?: |$)/.test(className)) {
                                    let recentPlayers = course.recentPlayers;

                                    if (!recentPlayers) {
                                        recentPlayers = [];
                                        course.recentPlayers = recentPlayers;
                                    }

                                    recentPlayers.push(player);
                                    return;
                                }
                            }

                            node = node.parent;
                            distance += 1;
                        }
                    }
                },
                onend: function onend() {
                    completeFunction(null, course);
                },
                onerror: function onerror(error) {
                    completeFunction((0, _isotropicError2.default)({
                        error: error
                    }));
                },
                onopentag: function onopentag(name, attributes) {
                    const className = attributes.class,
                          node = {
                        attributes: attributes,
                        children: [],
                        name: name,
                        parent: currentNode,
                        text: []
                    };

                    currentNode.children.push(node);
                    currentNode = node;

                    if (attributes.name === 'csrf-token' && attributes.content) {
                        course.csrfToken = attributes.content;
                    }

                    if (!className) {
                        return;
                    }

                    if (/(?:^| )course-clear-flag-wrapper(?: |$)/.test(className)) {
                        course.cleared = true;
                    } else if (name === 'img' && attributes.src && /(?:^| )course-image(?: |$)/.test(className)) {
                        course.thumbnailUrl = attributes.src;
                    } else if (name === 'img' && attributes.src && /(?:^| )course-image-full(?: |$)/.test(className)) {
                        course.imageUrl = attributes.src;
                    } else if (/(?:^| )gameskin(?: |$)/.test(className)) {
                        let match = className.match(/(?:^| )common_gs_([A-Za-z0-9]+)(?: |$)/);

                        match = match && gameStyles[match[1]] || match;

                        if (match) {
                            course.gameStyle = match;
                        }
                    } else if (/(?:^| )miiverse(?: |$)/.test(className) && attributes.href) {
                        course.miiversePostUrl = attributes.href;
                    }
                },
                ontext: function ontext(text) {
                    currentNode.text.push(text);
                }
            }, {
                decodeEntities: true,
                lowerCaseTags: false,
                recognizeSelfClosing: true
            }));
        });
    },

    /**
    @member {Boolean} module:super-mario-maker-client~SuperMarioMakerClient#isLoggedIn
    @readonly
    */
    get isLoggedIn() {
        return this._isLoggedIn;
    },
    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#logIn
    @arg {Object} config
    @arg {String} config.password
    @arg {String} config.username
    @arg {ErrorCallback} callbackFunction
    @returns {this}
    */
    logIn: function logIn(_ref2, callbackFunction) {
        let password = _ref2.password;
        let username = _ref2.username;

        if (this._isLoggedIn && this._session) {
            (0, _setImmediate3.default)(callbackFunction);
            return this;
        }

        return this._request({
            updateSession: true,
            url: this._superMarioMakerAuthUrl
        }, (error, authResponse) => {
            if (error) {
                callbackFunction((0, _isotropicError2.default)({
                    error: error
                }));
                return;
            }

            if (authResponse.statusCode !== 302 || typeof authResponse.headers.location !== 'string') {
                callbackFunction((0, _isotropicError2.default)({
                    details: {
                        response: authResponse
                    },
                    message: 'Super Mario Maker auth request failed.'
                }));
                return;
            }

            const location = (0, _url.parse)(authResponse.headers.location, true),
                  query = location.query;

            if (!location.hostname || !location.pathname || !query || !query.client_id || !query.redirect_uri || !query.response_type || !query.state) {
                callbackFunction((0, _isotropicError2.default)({
                    details: {
                        response: authResponse
                    },
                    message: 'Super Mario Maker auth request failed.'
                }));
                return;
            }

            this._request({
                body: (0, _querystring.stringify)((0, _assign2.default)(query, {
                    lang: this._lang,
                    nintendo_authenticate: '', // eslint-disable-line camelcase
                    nintendo_authorize: '', // eslint-disable-line camelcase
                    password: password,
                    scope: '',
                    username: username
                })),
                options: {
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        Referer: authResponse.headers.location
                    },
                    hostname: location.hostname,
                    method: 'POST',
                    path: location.pathname
                },
                sendSession: false,
                updateSession: false
            }, (error, logInResponse) => {
                if (error) {
                    callbackFunction((0, _isotropicError2.default)({
                        error: error
                    }));
                    return;
                }

                if (logInResponse.statusCode !== 303 || typeof logInResponse.headers.location !== 'string') {
                    callbackFunction((0, _isotropicError2.default)({
                        details: {
                            response: logInResponse
                        },
                        message: 'Super Mario Maker log in failed.'
                    }));
                    return;
                }

                this._request({
                    options: {
                        headers: {
                            Referer: authResponse.headers.location
                        }
                    },
                    sendSession: true,
                    updateSession: true,
                    url: logInResponse.headers.location
                }, error => {
                    if (error) {
                        callbackFunction((0, _isotropicError2.default)({
                            error: error
                        }));
                        return;
                    }

                    this._isLoggedIn = true;

                    callbackFunction();
                });
            });
        });
    },

    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#logOut
    @returns {this}
    */
    logOut: function logOut() {
        this._isLoggedIn = false;
        this._session = '';
        return this;
    },

    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#unbookmarkCourse
    @arg {Object} config
    @arg {String} config.courseId
    @arg {String} config.csrfToken
    @arg {ErrorCallback} callbackFunction
    @instance
    @returns {this}
    */
    unbookmarkCourse: function unbookmarkCourse(_ref3, callbackFunction) {
        let courseId = _ref3.courseId;
        let csrfToken = _ref3.csrfToken;

        if (!this._isLoggedIn) {
            (0, _setImmediate3.default)(callbackFunction, (0, _isotropicError2.default)({
                message: 'Not logged in.'
            }));
            return this;
        }

        return this._request({
            options: {
                headers: {
                    [this._csrfTokenHeaderName]: csrfToken
                },
                method: 'DELETE'
            },
            url: this._getCourseUnbookmarkUrl(courseId)
        }, (error, response) => {
            if (error) {
                callbackFunction((0, _isotropicError2.default)({
                    error: error
                }));
            } else if (response.statusCode === 200 || response.statusCode === 302) {
                callbackFunction();
            } else {
                callbackFunction((0, _isotropicError2.default)({
                    details: {
                        response: response
                    },
                    message: 'Failed to unbookmark course.'
                }));
            }
        });
    },

    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#_getCourseBookmarkUrl
    @arg {String} courseId
    @protected
    @returns {String}
    */
    _getCourseBookmarkUrl: function _getCourseBookmarkUrl(courseId) {
        return `${ this._getCourseUrl(courseId) }/play_at_later`;
    },

    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#_getCourseUnbookmarkUrl
    @arg {String} courseId
    @protected
    @returns {String}
    */
    _getCourseUnbookmarkUrl: function _getCourseUnbookmarkUrl(courseId) {
        return `${ this._superMarioMakerBookmarkUrl }/bookmarks/${ courseId }`;
    },

    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#_getCourseUrl
    @arg {String} courseId
    @protected
    @returns {String}
    */
    _getCourseUrl: function _getCourseUrl(courseId) {
        return `${ this._superMarioMakerBookmarkUrl }/courses/${ courseId }`;
    },

    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#_init
    @arg {Object} config
    @protected
    @returns {this}
    */
    _init: function _init() {
        var _ref4 = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        var _ref4$csrfTokenHeader = _ref4.csrfTokenHeaderName;
        let csrfTokenHeaderName = _ref4$csrfTokenHeader === undefined ? 'X-CSRF-Token' : _ref4$csrfTokenHeader;
        var _ref4$gameStyles = _ref4.gameStyles;
        let gameStyles = _ref4$gameStyles === undefined ? {
            sb: 'superMarioBros',
            sb3: 'superMarioBros3',
            sbu: 'newSuperMarioBrosU',
            sw: 'superMarioWorld'
        } : _ref4$gameStyles;
        var _ref4$lang = _ref4.lang;
        let lang = _ref4$lang === undefined ? 'en-US' : _ref4$lang;
        var _ref4$sessionCookieNa = _ref4.sessionCookieName;
        let sessionCookieName = _ref4$sessionCookieNa === undefined ? '_supermariomakerbookmark_session' : _ref4$sessionCookieNa;
        var _ref4$superMarioMaker = _ref4.superMarioMakerAuthUrl;
        let superMarioMakerAuthUrl = _ref4$superMarioMaker === undefined ? 'https://supermariomakerbookmark.nintendo.net/users/auth/nintendo' : _ref4$superMarioMaker;
        var _ref4$superMarioMaker2 = _ref4.superMarioMakerBookmarkUrl;
        let superMarioMakerBookmarkUrl = _ref4$superMarioMaker2 === undefined ? 'https://supermariomakerbookmark.nintendo.net' : _ref4$superMarioMaker2;

        this._csrfTokenHeaderName = csrfTokenHeaderName;
        this._gameStyles = gameStyles;
        this._isLoggedIn = false;
        this._lang = lang;
        this._requestInProgress = false;
        this._requestQueue = [];
        this._session = '';
        this._sessionCookieName = sessionCookieName;
        this._superMarioMakerAuthUrl = superMarioMakerAuthUrl;
        this._superMarioMakerBookmarkUrl = superMarioMakerBookmarkUrl;
        return this;
    },

    /**
    @method module:super-mario-maker-client~SuperMarioMakerClient#_request
    @arg {Object} config
    @arg {String} [config.body]
    @arg {Object} [config.options={}]
    @arg {Boolean} [config.sendSession]
    @arg {Boolean} [config.updateSession]
    @arg {String} [config.url]
    @arg {IncomingMessageCallback} callbackFunction
    @protected
    @returns {this}
    */
    _request: function _request(_ref5, callbackFunction) {
        let body = _ref5.body;
        var _ref5$options = _ref5.options;
        let options = _ref5$options === undefined ? {} : _ref5$options;
        let sendSession = _ref5.sendSession;
        let updateSession = _ref5.updateSession;
        let url = _ref5.url;

        if (this._requestInProgress) {
            this._requestQueue.push({
                callbackFunction: callbackFunction,
                options: options,
                url: url
            });

            return this;
        }

        this._requestInProgress = true;

        let complete;

        if (typeof sendSession === 'undefined') {
            sendSession = this._isLoggedIn;
        }

        if (typeof updateSession === 'undefined') {
            updateSession = this._isLoggedIn;
        }

        if (sendSession) {
            let headers = options.headers;

            if (!headers) {
                headers = {};
                options.headers = headers;
            }

            if (headers.Cookie) {
                if (new RegExp(`${ this._sessionCookieName }=.*?(?:;|$)`).test(headers.Cookie)) {
                    headers.Cookie = headers.Cookie.replace(new RegExp(`${ this._sessionCookieName }=.*?(;|$)`), `${ this._sessionCookieName }=${ this._session }$1`);
                } else {
                    headers.Cookie += `; ${ this._sessionCookieName }=${ this._session }`;
                }
            } else {
                headers.Cookie = `${ this._sessionCookieName }=${ this._session }`;
            }
        }

        const completeFunction = (error, response) => {
            if (complete) {
                return;
            }

            this._requestInProgress = false;
            complete = true;

            if (error) {
                callbackFunction((0, _isotropicError2.default)({
                    details: {
                        body: body,
                        options: options,
                        sendSession: sendSession,
                        updateSession: updateSession,
                        url: url
                    },
                    error: error,
                    message: 'Request error.'
                }));
            } else {
                callbackFunction(null, response);
            }

            const next = this._requestQueue.shift();

            if (next) {
                this._request(next, next.callbackFunction);
            }
        },
              request = (0, _https.request)(url ? (0, _assign2.default)((0, _url.parse)(url), options) : options, response => {
            if (!updateSession || Array.isArray(response.headers['set-cookie']) && response.headers['set-cookie'].some(cookie => {
                const match = cookie.match(new RegExp(`${ this._sessionCookieName }=(.*?);`));

                if (match) {
                    this._session = match[1];
                    return true;
                }

                return false;
            })) {
                completeFunction(null, response);
            } else {
                completeFunction((0, _isotropicError2.default)({
                    message: 'Failed to update session.'
                }));
            }
        });

        request.on('error', error => {
            completeFunction((0, _isotropicError2.default)({
                error: error
            }));
        });

        request.end(body);

        return this;
    }
}),


/**
@function fetchCourse
@arg {String} courseId
@arg {CourseCallback} callbackFunction
*/
_fetchCourse = function _fetchCourse() {
    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
    }

    (0, _apply2.default)(_SuperMarioMakerClient.prototype.fetchCourse, _SuperMarioMakerClient(), args);
},


/**
@function logIn
@arg {Object} config
@arg {String} config.password
@arg {String} config.username
@arg {SuperMarioMakerClientCallback} callbackFunction
*/
_logIn = function _logIn(config, callbackFunction) {
    const superMarioMakerClient = _SuperMarioMakerClient().logIn(config, error => {
        if (error) {
            callbackFunction((0, _isotropicError2.default)({
                error: error
            }));
        } else {
            callbackFunction(null, superMarioMakerClient);
        }
    });
};

exports.fetchCourse = _fetchCourse;
exports.logIn = _logIn;
exports.default = _SuperMarioMakerClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2pzL3N1cGVyLW1hcmlvLW1ha2VyLWNsaWVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QkE7Ozs7QUFFQTs7QUFJQTs7OztBQUVBOztBQUlBOztBQUlBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFjQSxNQUFNLHlCQUF5Qiw2QkFBTTs7Ozs7Ozs7Ozs7QUFVN0Isa0JBVjZCLGdDQWExQixnQkFiMEIsRUFhUjtBQUFBLFlBRmpCLFFBRWlCLFFBRmpCLFFBRWlCO0FBQUEsWUFEakIsU0FDaUIsUUFEakIsU0FDaUI7O0FBQ2pCLFlBQUksQ0FBQyxLQUFLLFdBQVYsRUFBdUI7QUFDbkIsd0NBQWEsZ0JBQWIsRUFBK0IsOEJBQU87QUFDbEMseUJBQVM7QUFEeUIsYUFBUCxDQUEvQjtBQUdBLG1CQUFPLElBQVA7QUFDSDs7QUFFRCxlQUFPLEtBQUssUUFBTCxDQUFjO0FBQ2pCLHFCQUFTO0FBQ0wseUJBQVM7QUFDTCxxQkFBQyxLQUFLLG9CQUFOLEdBQTZCO0FBRHhCLGlCQURKO0FBSUwsd0JBQVE7QUFKSCxhQURRO0FBT2pCLGlCQUFLLEtBQUsscUJBQUwsQ0FBMkIsUUFBM0I7QUFQWSxTQUFkLEVBUUosQ0FBQyxLQUFELEVBQVEsUUFBUixLQUFxQjtBQUNwQixnQkFBSSxLQUFKLEVBQVc7QUFDUCxpQ0FBaUIsOEJBQU87QUFDcEI7QUFEb0IsaUJBQVAsQ0FBakI7QUFHSCxhQUpELE1BSU8sSUFBSSxTQUFTLFVBQVQsS0FBd0IsR0FBNUIsRUFBaUM7QUFDcEM7QUFDSCxhQUZNLE1BRUE7QUFDSCxpQ0FBaUIsOEJBQU87QUFDcEIsNkJBQVM7QUFDTDtBQURLLHFCQURXO0FBSXBCLDZCQUFTO0FBSlcsaUJBQVAsQ0FBakI7QUFNSDtBQUNKLFNBdkJNLENBQVA7QUF3QkgsS0E3QzRCOzs7Ozs7OztBQW9EN0IsZUFwRDZCLHVCQW9EaEIsUUFwRGdCLEVBb0ROLGdCQXBETSxFQW9EWTtBQUNyQyxlQUFPLEtBQUssUUFBTCxDQUFjO0FBQ2pCLGlCQUFLLEtBQUssYUFBTCxDQUFtQixRQUFuQjtBQURZLFNBQWQsRUFFSixDQUFDLEtBQUQsRUFBUSxRQUFSLEtBQXFCO0FBQ3BCLGdCQUFJLEtBQUosRUFBVztBQUNQLGlDQUFpQiw4QkFBTztBQUNwQjtBQURvQixpQkFBUCxDQUFqQjtBQUdBO0FBQ0g7O0FBRUQsZ0JBQUksU0FBUyxVQUFULEtBQXdCLEdBQTVCLEVBQWlDO0FBQzdCLGlDQUFpQiw4QkFBTztBQUNwQiw2QkFBUztBQUNMO0FBREsscUJBRFc7QUFJcEIsNkJBQVM7QUFKVyxpQkFBUCxDQUFqQjtBQU1BO0FBQ0g7O0FBRUQsZ0JBQUksUUFBSjtnQkFDSSxjQUFjO0FBQ1YsNEJBQVksRUFERjtBQUVWLDBCQUFVLEVBRkE7QUFHVixzQkFBTSxNQUhJO0FBSVYsc0JBQU07QUFKSSxhQURsQjs7QUFRQSxrQkFBTSxtQkFBbUIsQ0FBQyxLQUFELEVBQVEsTUFBUixLQUFtQjtBQUNwQyxvQkFBSSxRQUFKLEVBQWM7QUFDVjtBQUNIOztBQUVELDJCQUFXLElBQVg7O0FBRUEsb0JBQUksS0FBSixFQUFXO0FBQ1AscUNBQWlCLDhCQUFPO0FBQ3BCLG9DQURvQjtBQUVwQixpQ0FBUztBQUZXLHFCQUFQLENBQWpCO0FBSUgsaUJBTEQsTUFLTztBQUNILHFDQUFpQixJQUFqQixFQUF1QixNQUF2QjtBQUNIO0FBQ0osYUFmTDtrQkFnQkksU0FBUztBQUNMO0FBREssYUFoQmI7a0JBbUJJLGFBQWEsS0FBSyxXQW5CdEI7O0FBcUJBLHFCQUFTLElBQVQsQ0FBYyx1QkFBZ0I7QUFDMUIsMEJBRDBCLHNCQUNkLElBRGMsRUFDUjtBQUNkLHdCQUFJLFlBQVksSUFBWixLQUFxQixJQUF6QixFQUErQjtBQUMzQix5Q0FBaUIsOEJBQU87QUFDcEIscUNBQVM7QUFDTDtBQURLLDZCQURXO0FBSXBCLHFDQUFTO0FBSlcseUJBQVAsQ0FBakI7O0FBT0EsaUNBQVMsTUFBVDtBQUNBO0FBQ0g7O0FBRUQsMEJBQU0sWUFBWSxZQUFZLFVBQVosQ0FBdUIsS0FBekM7MEJBQ0ksYUFBYSxXQURqQjs7QUFHQSxrQ0FBYyxZQUFZLE1BQTFCOztBQUVBLHdCQUFJLENBQUMsU0FBTCxFQUFnQjtBQUNaO0FBQ0g7O0FBRUQsd0JBQUksMkJBQTJCLElBQTNCLENBQWdDLFNBQWhDLENBQUosRUFBZ0Q7QUFDNUMsNEJBQUksU0FBUyxFQUFiOztBQUVBLG1DQUFXLFFBQVgsQ0FBb0IsT0FBcEIsQ0FBNEIsYUFBYTtBQUNyQyxrQ0FBTSxZQUFZLFVBQVUsVUFBVixDQUFxQixLQUF2QztrQ0FDSSxRQUFRLGFBQWEsVUFBVSxLQUFWLENBQWdCLHNDQUFoQixDQUR6Qjs7QUFHQSxnQ0FBSSxDQUFDLEtBQUwsRUFBWTtBQUNSO0FBQ0g7O0FBRUQsZ0NBQUksTUFBTSxDQUFOLE1BQWEsUUFBakIsRUFBMkI7QUFDdkIsMENBQVUsR0FBVjtBQUNILDZCQUZELE1BRU87QUFDSCwwQ0FBVSxNQUFNLENBQU4sQ0FBVjtBQUNIO0FBQ0oseUJBYkQ7O0FBZUEsNEJBQUksTUFBSixFQUFZO0FBQ1IsbUNBQU8sU0FBUCxHQUFtQixDQUFDLE1BQXBCO0FBQ0g7QUFDSixxQkFyQkQsTUFxQk8sSUFBSSwyQkFBMkIsSUFBM0IsQ0FBZ0MsU0FBaEMsQ0FBSixFQUFnRDtBQUNuRCw0QkFBSSxTQUFTLEVBQWI7NEJBQ0ksT0FESjs0QkFFSSxPQUZKOztBQUlBLG1DQUFXLFFBQVgsQ0FBb0IsT0FBcEIsQ0FBNEIsYUFBYTtBQUNyQyxrQ0FBTSxZQUFZLFVBQVUsVUFBVixDQUFxQixLQUF2QztrQ0FDSSxRQUFRLGFBQWEsVUFBVSxLQUFWLENBQWdCLDZDQUFoQixDQUR6Qjs7QUFHQSxnQ0FBSSxDQUFDLEtBQUwsRUFBWTtBQUNSO0FBQ0g7O0FBRUQsZ0NBQUksTUFBTSxDQUFOLE1BQWEsUUFBakIsRUFBMkI7QUFDdkIsb0NBQUksTUFBSixFQUFZO0FBQ1IsOENBQVUsQ0FBQyxNQUFYO0FBQ0EsNkNBQVMsRUFBVDtBQUNIO0FBQ0osNkJBTEQsTUFLTyxJQUFJLE1BQU0sQ0FBTixNQUFhLFFBQWpCLEVBQTJCO0FBQzlCLG9DQUFJLE1BQUosRUFBWTtBQUNSLDhDQUFVLENBQUMsTUFBWDtBQUNBLDZDQUFTLEVBQVQ7QUFDSDtBQUNKLDZCQUxNLE1BS0E7QUFDSCwwQ0FBVSxNQUFNLENBQU4sQ0FBVjtBQUNIO0FBQ0oseUJBckJEOztBQXVCQSw0QkFBSSxVQUFVLE9BQVYsSUFBcUIsT0FBekIsRUFBa0M7QUFDOUIsZ0NBQUksV0FBVyxDQUFmO2dDQUNJLE9BQU8sV0FBVyxNQUR0QjtnQ0FFSSxXQUZKOztBQUlBLGtDQUFNLE9BQU8sQ0FBQyxXQUFXLENBQVosSUFBaUIsS0FBakIsR0FBeUIsQ0FBQyxXQUFXLENBQVosSUFBaUIsSUFBMUMsSUFBa0QsQ0FBQyxNQUFELElBQVcsQ0FBN0QsQ0FBYjs7QUFFQSxtQ0FBTyxRQUFRLFdBQVcsQ0FBMUIsRUFBNkI7QUFDekIsc0NBQU0sWUFBWSxLQUFLLFVBQUwsQ0FBZ0IsS0FBbEM7O0FBRUEsb0NBQUksYUFBYSw2QkFBNkIsSUFBN0IsQ0FBa0MsU0FBbEMsQ0FBakIsRUFBK0Q7QUFDM0Qsa0RBQWMsSUFBZDtBQUNIOztBQUVELHVDQUFPLEtBQUssTUFBWjtBQUNBLDRDQUFZLENBQVo7QUFDSDs7QUFFRCxnQ0FBSSxXQUFKLEVBQWlCO0FBQ2IsOENBQWMsT0FBTyxXQUFyQjs7QUFFQSxvQ0FBSSxDQUFDLFdBQUwsRUFBa0I7QUFDZCxrREFBYyxFQUFkO0FBQ0EsMkNBQU8sV0FBUCxHQUFxQixXQUFyQjtBQUNIOztBQUVELDRDQUFZLElBQVosR0FBbUIsSUFBbkI7QUFDSCw2QkFURCxNQVNPO0FBQ0gsdUNBQU8sWUFBUCxHQUFzQixJQUF0QjtBQUNIO0FBQ0o7QUFDSixxQkEzRE0sTUEyREEsSUFBSSxzQ0FBc0MsSUFBdEMsQ0FBMkMsU0FBM0MsQ0FBSixFQUEyRDtBQUM5RCxtQ0FBVyxRQUFYLENBQW9CLE9BQXBCLENBQTRCLGFBQWE7QUFDckMsa0NBQU0sWUFBWSxVQUFVLFVBQVYsQ0FBcUIsS0FBdkM7O0FBRUEsZ0NBQUksQ0FBQyxTQUFMLEVBQWdCO0FBQ1o7QUFDSDs7QUFFRCxnQ0FBSSx3QkFBd0IsSUFBeEIsQ0FBNkIsU0FBN0IsQ0FBSixFQUE2QztBQUN6QyxzQ0FBTSxhQUFhLGFBQWE7QUFDeEIsd0NBQUksVUFBVSxJQUFWLEtBQW1CLEtBQW5CLElBQTRCLFVBQVUsVUFBVixDQUFxQixHQUFyRCxFQUEwRDtBQUN0RCwrQ0FBTyxVQUFVLFVBQVYsQ0FBcUIsR0FBNUI7QUFDSDs7QUFFRCx3Q0FBSSxNQUFKOztBQUVBLDhDQUFVLFFBQVYsQ0FBbUIsSUFBbkIsQ0FBd0IsYUFBYTtBQUNqQyxpREFBUyxXQUFXLFNBQVgsQ0FBVDtBQUNBLCtDQUFPLE1BQVA7QUFDSCxxQ0FIRDs7QUFLQSwyQ0FBTyxNQUFQO0FBQ0gsaUNBYkw7c0NBY0ksU0FBUyxXQUFXLFNBQVgsQ0FkYjs7QUFnQkEsb0NBQUksQ0FBQyxNQUFMLEVBQWE7QUFDVDtBQUNIOztBQUVELG9DQUFJLFVBQVUsT0FBTyxPQUFyQjs7QUFFQSxvQ0FBSSxDQUFDLE9BQUwsRUFBYztBQUNWLDhDQUFVLEVBQVY7QUFDQSwyQ0FBTyxPQUFQLEdBQWlCLE9BQWpCO0FBQ0g7O0FBRUQsd0NBQVEsVUFBUixHQUFxQixNQUFyQjtBQUNILDZCQTdCRCxNQTZCTyxJQUFJLDZCQUE2QixJQUE3QixDQUFrQyxTQUFsQyxDQUFKLEVBQWtEO0FBQ3JELG9DQUFJLFVBQVUsT0FBTyxPQUFyQjs7QUFFQSxvQ0FBSSxDQUFDLE9BQUwsRUFBYztBQUNWLDhDQUFVLEVBQVY7QUFDQSwyQ0FBTyxPQUFQLEdBQWlCLE9BQWpCO0FBQ0g7O0FBRUQsMENBQVUsUUFBVixDQUFtQixPQUFuQixDQUEyQixhQUFhO0FBQ3BDLDBDQUFNLFlBQVksVUFBVSxVQUFWLENBQXFCLEtBQXZDOztBQUVBLHdDQUFJLENBQUMsU0FBTCxFQUFnQjtBQUNaO0FBQ0g7O0FBRUQsd0NBQUkscUJBQXFCLElBQXJCLENBQTBCLFNBQTFCLENBQUosRUFBMEM7QUFDdEMsOENBQU0sVUFBVSxVQUFVLEtBQVYsQ0FBZ0IsR0FBaEIsRUFBcUIsTUFBckIsQ0FBNEIsYUFBYSxjQUFjLE1BQXZELEVBQStELENBQS9ELENBQWhCOztBQUVBLDRDQUFJLE9BQUosRUFBYTtBQUNULG9EQUFRLE9BQVIsR0FBa0IsT0FBbEI7QUFDSDtBQUNKLHFDQU5ELE1BTU8sSUFBSSx1QkFBdUIsSUFBdkIsQ0FBNEIsU0FBNUIsQ0FBSixFQUE0QztBQUMvQyw0Q0FBSSxRQUFRLFVBQVUsS0FBVixDQUFnQixxQ0FBaEIsQ0FBWjs7QUFFQSxnREFBUSxTQUFTLE1BQU0sQ0FBTixDQUFqQjs7QUFFQSw0Q0FBSSxLQUFKLEVBQVc7QUFDUCxnREFBSSxVQUFVLElBQWQsRUFBb0I7QUFDaEIsb0RBQUksU0FBUyxFQUFiOztBQUVBLDBEQUFVLFFBQVYsQ0FBbUIsT0FBbkIsQ0FBMkIsYUFBYTtBQUNwQywwREFBTSxZQUFZLFVBQVUsVUFBVixDQUFxQixLQUF2QzswREFDSSxRQUFRLGFBQWEsVUFBVSxLQUFWLENBQWdCLCtCQUFoQixDQUR6Qjs7QUFHQSx3REFBSSxLQUFKLEVBQVc7QUFDUCxrRUFBVSxNQUFNLENBQU4sQ0FBVjtBQUNIO0FBQ0osaURBUEQ7O0FBU0Esb0RBQUksTUFBSixFQUFZO0FBQ1IsNERBQVEsTUFBUixHQUFpQixDQUFDLE1BQWxCO0FBQ0g7QUFDSiw2Q0FmRCxNQWVPO0FBQ0gsd0RBQVEsTUFBUixHQUFpQixDQUFDLEtBQWxCO0FBQ0g7QUFDSjtBQUNKLHFDQXpCTSxNQXlCQSxJQUFJLHFCQUFxQixJQUFyQixDQUEwQixTQUExQixDQUFKLEVBQTBDO0FBQzdDLDhDQUFNLE9BQU8sVUFBVSxJQUFWLENBQWUsQ0FBZixDQUFiOztBQUVBLDRDQUFJLElBQUosRUFBVTtBQUNOLG9EQUFRLE9BQVIsR0FBa0IsSUFBbEI7QUFDSDtBQUNKO0FBQ0osaUNBN0NEO0FBOENIO0FBQ0oseUJBM0ZEO0FBNEZILHFCQTdGTSxNQTZGQSxJQUFJLDhCQUE4QixJQUE5QixDQUFtQyxTQUFuQyxLQUFpRCxXQUFXLElBQVgsQ0FBZ0IsTUFBckUsRUFBNkU7QUFDaEYsOEJBQU0sYUFBYSxXQUFXLElBQVgsQ0FBZ0IsSUFBaEIsQ0FBcUIsRUFBckIsQ0FBbkI7O0FBRUEsK0JBQU8sVUFBUCxHQUFvQixXQUFXLE1BQVgsQ0FBa0IsQ0FBbEIsRUFBcUIsV0FBckIsS0FBcUMsV0FBVyxNQUFYLENBQWtCLENBQWxCLEVBQXFCLE9BQXJCLENBQTZCLElBQTdCLEVBQW1DLEVBQW5DLENBQXpEO0FBQ0gscUJBSk0sTUFJQSxJQUFJLDJCQUEyQixJQUEzQixDQUFnQyxTQUFoQyxLQUE4QyxXQUFXLElBQVgsQ0FBZ0IsTUFBbEUsRUFBMEU7QUFDN0UsOEJBQU0sTUFBTSxXQUFXLElBQVgsQ0FBZ0IsSUFBaEIsQ0FBcUIsRUFBckIsQ0FBWjs7QUFFQSw0QkFBSSxPQUFPLFFBQVEsS0FBbkIsRUFBMEI7QUFDdEIsbUNBQU8sR0FBUCxHQUFhLEdBQWI7QUFDSDtBQUNKLHFCQU5NLE1BTUEsSUFBSSw2QkFBNkIsSUFBN0IsQ0FBa0MsU0FBbEMsS0FBZ0QsV0FBVyxJQUFYLENBQWdCLE1BQXBFLEVBQTRFO0FBQy9FLCtCQUFPLEtBQVAsR0FBZSxXQUFXLElBQVgsQ0FBZ0IsSUFBaEIsQ0FBcUIsRUFBckIsQ0FBZjtBQUNILHFCQUZNLE1BRUEsSUFBSSwyQkFBMkIsSUFBM0IsQ0FBZ0MsU0FBaEMsS0FBOEMsV0FBVyxJQUFYLENBQWdCLE1BQWxFLEVBQTBFO0FBQzdFLDhCQUFNLFlBQVksV0FBVyxJQUFYLENBQWdCLElBQWhCLENBQXFCLEVBQXJCLENBQWxCOzhCQUNJLFFBQVEsVUFBVSxLQUFWLENBQWdCLDBCQUFoQixDQURaOztBQUdBLCtCQUFPLFNBQVAsR0FBbUIsU0FBbkI7O0FBRUEsNEJBQUksS0FBSixFQUFXO0FBQ1AsZ0NBQUksZUFBSjs7QUFFQSxvQ0FBUSxNQUFNLENBQU4sQ0FBUjtBQUNJLHFDQUFLLEtBQUw7QUFDSSxzREFBa0IsUUFBbEI7QUFDQTtBQUNKLHFDQUFLLE1BQUw7QUFDSSxzREFBa0IsT0FBbEI7QUFDQTtBQUNKO0FBQ0k7QUFSUjs7QUFXQSxtQ0FBTyxVQUFQLEdBQW9CLElBQUksSUFBSixDQUFTLElBQUksSUFBSixHQUFXLE9BQVgsS0FBdUIsTUFBTSxDQUFOLElBQVcsZUFBM0MsQ0FBcEI7QUFDSCx5QkFmRCxNQWVPO0FBQ0gsa0NBQU0sYUFBYSxJQUFJLElBQUosQ0FBUyxTQUFULENBQW5COztBQUVBLGdDQUFJLENBQUMscUJBQWEsV0FBVyxPQUFYLEVBQWIsQ0FBTCxFQUF5QztBQUNyQyx1Q0FBTyxVQUFQLEdBQW9CLFVBQXBCO0FBQ0g7QUFDSjtBQUNKLHFCQTVCTSxNQTRCQSxJQUFJLDRCQUE0QixJQUE1QixDQUFpQyxTQUFqQyxDQUFKLEVBQWlEO0FBQ3BELDRCQUFJLFNBQVMsRUFBYjs7QUFFQSxtQ0FBVyxRQUFYLENBQW9CLE9BQXBCLENBQTRCLGFBQWE7QUFDckMsa0NBQU0sWUFBWSxVQUFVLFVBQVYsQ0FBcUIsS0FBdkM7a0NBQ0ksUUFBUSxhQUFhLFVBQVUsS0FBVixDQUFnQiwrQkFBaEIsQ0FEekI7O0FBR0EsZ0NBQUksS0FBSixFQUFXO0FBQ1AsMENBQVUsTUFBTSxDQUFOLENBQVY7QUFDSDtBQUNKLHlCQVBEOztBQVNBLDRCQUFJLE1BQUosRUFBWTtBQUNSLG1DQUFPLEtBQVAsR0FBZSxDQUFDLE1BQWhCO0FBQ0g7QUFDSixxQkFmTSxNQWVBLElBQUksNkJBQTZCLElBQTdCLENBQWtDLFNBQWxDLENBQUosRUFBa0Q7QUFDckQsNEJBQUksU0FBUyxFQUFiOztBQUVBLG1DQUFXLFFBQVgsQ0FBb0IsT0FBcEIsQ0FBNEIsYUFBYTtBQUNyQyxrQ0FBTSxZQUFZLFVBQVUsVUFBVixDQUFxQixLQUF2QztrQ0FDSSxRQUFRLGFBQWEsVUFBVSxLQUFWLENBQWdCLCtCQUFoQixDQUR6Qjs7QUFHQSxnQ0FBSSxLQUFKLEVBQVc7QUFDUCwwQ0FBVSxNQUFNLENBQU4sQ0FBVjtBQUNIO0FBQ0oseUJBUEQ7O0FBU0EsNEJBQUksTUFBSixFQUFZO0FBQ1IsbUNBQU8sT0FBUCxHQUFpQixDQUFDLE1BQWxCO0FBQ0g7QUFDSixxQkFmTSxNQWVBLElBQUksNkJBQTZCLElBQTdCLENBQWtDLFNBQWxDLENBQUosRUFBa0Q7QUFDckQsNEJBQUksU0FBUyxFQUFiOztBQUVBLG1DQUFXLFFBQVgsQ0FBb0IsT0FBcEIsQ0FBNEIsYUFBYTtBQUNyQyxrQ0FBTSxZQUFZLFVBQVUsVUFBVixDQUFxQixLQUF2QztrQ0FDSSxRQUFRLGFBQWEsVUFBVSxLQUFWLENBQWdCLCtCQUFoQixDQUR6Qjs7QUFHQSxnQ0FBSSxLQUFKLEVBQVc7QUFDUCwwQ0FBVSxNQUFNLENBQU4sQ0FBVjtBQUNIO0FBQ0oseUJBUEQ7O0FBU0EsNEJBQUksTUFBSixFQUFZO0FBQ1IsbUNBQU8sTUFBUCxHQUFnQixDQUFDLE1BQWpCO0FBQ0g7QUFDSixxQkFmTSxNQWVBLElBQUksNEJBQTRCLElBQTVCLENBQWlDLFNBQWpDLENBQUosRUFBaUQ7QUFDcEQsNEJBQUksU0FBUyxFQUFiOztBQUVBLG1DQUFXLFFBQVgsQ0FBb0IsT0FBcEIsQ0FBNEIsYUFBYTtBQUNyQyxrQ0FBTSxZQUFZLFVBQVUsVUFBVixDQUFxQixLQUF2QztrQ0FDSSxRQUFRLGFBQWEsVUFBVSxLQUFWLENBQWdCLHFDQUFoQixDQUR6Qjs7QUFHQSxnQ0FBSSxDQUFDLEtBQUwsRUFBWTtBQUNSO0FBQ0g7O0FBRUQsZ0NBQUksTUFBTSxDQUFOLE1BQWEsT0FBakIsRUFBMEI7QUFDdEIsb0NBQUksTUFBSixFQUFZO0FBQ1IsMkNBQU8sTUFBUCxHQUFnQixDQUFDLE1BQWpCO0FBQ0EsNkNBQVMsRUFBVDtBQUNIO0FBQ0osNkJBTEQsTUFLTztBQUNILDBDQUFVLE1BQU0sQ0FBTixDQUFWO0FBQ0g7QUFDSix5QkFoQkQ7O0FBa0JBLDRCQUFJLE1BQUosRUFBWTtBQUNSLG1DQUFPLFFBQVAsR0FBa0IsQ0FBQyxNQUFuQjtBQUNIO0FBQ0oscUJBeEJNLE1Bd0JBLElBQUksNkJBQTZCLElBQTdCLENBQWtDLFNBQWxDLENBQUosRUFBa0Q7QUFDckQsOEJBQU0sU0FBUyxFQUFmOztBQUVBLG1DQUFXLFFBQVgsQ0FBb0IsT0FBcEIsQ0FBNEIsYUFBYTtBQUNyQyxrQ0FBTSxZQUFZLFVBQVUsVUFBVixDQUFxQixLQUF2Qzs7QUFFQSxnQ0FBSSxDQUFDLFNBQUwsRUFBZ0I7QUFDWjtBQUNIOztBQUVELGdDQUFJLDRCQUE0QixJQUE1QixDQUFpQyxTQUFqQyxDQUFKLEVBQWlEO0FBQzdDLHNDQUFNLGFBQWEsYUFBYTtBQUN4Qix3Q0FBSSxVQUFVLElBQVYsS0FBbUIsS0FBbkIsSUFBNEIsVUFBVSxVQUFWLENBQXFCLEdBQXJELEVBQTBEO0FBQ3RELCtDQUFPLFVBQVUsVUFBVixDQUFxQixHQUE1QjtBQUNIOztBQUVELHdDQUFJLE1BQUo7O0FBRUEsOENBQVUsUUFBVixDQUFtQixJQUFuQixDQUF3QixhQUFhO0FBQ2pDLGlEQUFTLFdBQVcsU0FBWCxDQUFUO0FBQ0EsK0NBQU8sTUFBUDtBQUNILHFDQUhEOztBQUtBLDJDQUFPLE1BQVA7QUFDSCxpQ0FiTDtzQ0FjSSxTQUFTLFdBQVcsU0FBWCxDQWRiOztBQWdCQSxvQ0FBSSxNQUFKLEVBQVk7QUFDUiwyQ0FBTyxVQUFQLEdBQW9CLE1BQXBCO0FBQ0g7QUFDSiw2QkFwQkQsTUFvQk8sSUFBSSwwQkFBMEIsSUFBMUIsQ0FBK0IsU0FBL0IsQ0FBSixFQUErQztBQUNsRCwwQ0FBVSxRQUFWLENBQW1CLE9BQW5CLENBQTJCLGFBQWE7QUFDcEMsMENBQU0sWUFBWSxVQUFVLFVBQVYsQ0FBcUIsS0FBdkM7O0FBRUEsd0NBQUksQ0FBQyxTQUFMLEVBQWdCO0FBQ1o7QUFDSDs7QUFFRCx3Q0FBSSxxQkFBcUIsSUFBckIsQ0FBMEIsU0FBMUIsQ0FBSixFQUEwQztBQUN0Qyw4Q0FBTSxVQUFVLFVBQVUsS0FBVixDQUFnQixHQUFoQixFQUFxQixNQUFyQixDQUE0QixhQUFhLGNBQWMsTUFBdkQsRUFBK0QsQ0FBL0QsQ0FBaEI7O0FBRUEsNENBQUksT0FBSixFQUFhO0FBQ1QsbURBQU8sT0FBUCxHQUFpQixPQUFqQjtBQUNIO0FBQ0oscUNBTkQsTUFNTyxJQUFJLHFCQUFxQixJQUFyQixDQUEwQixTQUExQixDQUFKLEVBQTBDO0FBQzdDLDhDQUFNLE9BQU8sVUFBVSxJQUFWLENBQWUsQ0FBZixDQUFiOztBQUVBLDRDQUFJLElBQUosRUFBVTtBQUNOLG1EQUFPLE9BQVAsR0FBaUIsSUFBakI7QUFDSDtBQUNKO0FBQ0osaUNBcEJEO0FBcUJIO0FBQ0oseUJBbEREOztBQW9EQSw0QkFBSSxDQUFDLG9CQUFZLE1BQVosRUFBb0IsTUFBekIsRUFBaUM7QUFDN0I7QUFDSDs7QUFFRCw0QkFBSSxXQUFXLENBQWY7NEJBQ0ksT0FBTyxXQUFXLE1BRHRCOztBQUdBLCtCQUFPLFFBQVEsV0FBVyxDQUExQixFQUE2QjtBQUN6QixrQ0FBTSxZQUFZLEtBQUssVUFBTCxDQUFnQixLQUFsQzs7QUFFQSxnQ0FBSSxTQUFKLEVBQWU7QUFDWCxvQ0FBSSw2QkFBNkIsSUFBN0IsQ0FBa0MsU0FBbEMsQ0FBSixFQUFrRDtBQUM5Qyx3Q0FBSSxZQUFZLE9BQU8sU0FBdkI7O0FBRUEsd0NBQUksQ0FBQyxTQUFMLEVBQWdCO0FBQ1osb0RBQVksRUFBWjtBQUNBLCtDQUFPLFNBQVAsR0FBbUIsU0FBbkI7QUFDSDs7QUFFRCw4Q0FBVSxJQUFWLENBQWUsTUFBZjtBQUNBO0FBQ0g7O0FBRUQsb0NBQUksNkJBQTZCLElBQTdCLENBQWtDLFNBQWxDLENBQUosRUFBa0Q7QUFDOUMsd0NBQUksY0FBYyxPQUFPLFdBQXpCOztBQUVBLHdDQUFJLENBQUMsV0FBTCxFQUFrQjtBQUNkLHNEQUFjLEVBQWQ7QUFDQSwrQ0FBTyxXQUFQLEdBQXFCLFdBQXJCO0FBQ0g7O0FBRUQsZ0RBQVksTUFBWixHQUFxQixNQUFyQjtBQUNBO0FBQ0g7O0FBRUQsb0NBQUksMkJBQTJCLElBQTNCLENBQWdDLFNBQWhDLENBQUosRUFBZ0Q7QUFDNUMsMkNBQU8sWUFBUCxHQUFzQixNQUF0QjtBQUNBO0FBQ0g7O0FBRUQsb0NBQUksMkJBQTJCLElBQTNCLENBQWdDLFNBQWhDLENBQUosRUFBZ0Q7QUFDNUMsd0NBQUksWUFBWSxPQUFPLFNBQXZCOztBQUVBLHdDQUFJLENBQUMsU0FBTCxFQUFnQjtBQUNaLG9EQUFZLEVBQVo7QUFDQSwrQ0FBTyxTQUFQLEdBQW1CLFNBQW5CO0FBQ0g7O0FBRUQsOENBQVUsSUFBVixDQUFlLE1BQWY7QUFDQTtBQUNIOztBQUVELG9DQUFJLDRCQUE0QixJQUE1QixDQUFpQyxTQUFqQyxDQUFKLEVBQWlEO0FBQzdDLHdDQUFJLGdCQUFnQixPQUFPLGFBQTNCOztBQUVBLHdDQUFJLENBQUMsYUFBTCxFQUFvQjtBQUNoQix3REFBZ0IsRUFBaEI7QUFDQSwrQ0FBTyxhQUFQLEdBQXVCLGFBQXZCO0FBQ0g7O0FBRUQsa0RBQWMsSUFBZCxDQUFtQixNQUFuQjtBQUNBO0FBQ0g7QUFDSjs7QUFFRCxtQ0FBTyxLQUFLLE1BQVo7QUFDQSx3Q0FBWSxDQUFaO0FBQ0g7QUFDSjtBQUNKLGlCQTdheUI7QUE4YTFCLHFCQTlhMEIsbUJBOGFqQjtBQUNMLHFDQUFpQixJQUFqQixFQUF1QixNQUF2QjtBQUNILGlCQWhieUI7QUFpYjFCLHVCQWpiMEIsbUJBaWJqQixLQWpiaUIsRUFpYlY7QUFDWixxQ0FBaUIsOEJBQU87QUFDcEI7QUFEb0IscUJBQVAsQ0FBakI7QUFHSCxpQkFyYnlCO0FBc2IxQix5QkF0YjBCLHFCQXNiZixJQXRiZSxFQXNiVCxVQXRiUyxFQXNiRztBQUN6QiwwQkFBTSxZQUFZLFdBQVcsS0FBN0I7MEJBQ0ksT0FBTztBQUNILDhDQURHO0FBRUgsa0NBQVUsRUFGUDtBQUdILGtDQUhHO0FBSUgsZ0NBQVEsV0FKTDtBQUtILDhCQUFNO0FBTEgscUJBRFg7O0FBU0EsZ0NBQVksUUFBWixDQUFxQixJQUFyQixDQUEwQixJQUExQjtBQUNBLGtDQUFjLElBQWQ7O0FBRUEsd0JBQUksV0FBVyxJQUFYLEtBQW9CLFlBQXBCLElBQW9DLFdBQVcsT0FBbkQsRUFBNEQ7QUFDeEQsK0JBQU8sU0FBUCxHQUFtQixXQUFXLE9BQTlCO0FBQ0g7O0FBRUQsd0JBQUksQ0FBQyxTQUFMLEVBQWdCO0FBQ1o7QUFDSDs7QUFFRCx3QkFBSSwwQ0FBMEMsSUFBMUMsQ0FBK0MsU0FBL0MsQ0FBSixFQUErRDtBQUMzRCwrQkFBTyxPQUFQLEdBQWlCLElBQWpCO0FBQ0gscUJBRkQsTUFFTyxJQUFJLFNBQVMsS0FBVCxJQUFrQixXQUFXLEdBQTdCLElBQW9DLDZCQUE2QixJQUE3QixDQUFrQyxTQUFsQyxDQUF4QyxFQUFzRjtBQUN6RiwrQkFBTyxZQUFQLEdBQXNCLFdBQVcsR0FBakM7QUFDSCxxQkFGTSxNQUVBLElBQUksU0FBUyxLQUFULElBQWtCLFdBQVcsR0FBN0IsSUFBb0Msa0NBQWtDLElBQWxDLENBQXVDLFNBQXZDLENBQXhDLEVBQTJGO0FBQzlGLCtCQUFPLFFBQVAsR0FBa0IsV0FBVyxHQUE3QjtBQUNILHFCQUZNLE1BRUEsSUFBSSx5QkFBeUIsSUFBekIsQ0FBOEIsU0FBOUIsQ0FBSixFQUE4QztBQUNqRCw0QkFBSSxRQUFRLFVBQVUsS0FBVixDQUFnQix3Q0FBaEIsQ0FBWjs7QUFFQSxnQ0FBUSxTQUFTLFdBQVcsTUFBTSxDQUFOLENBQVgsQ0FBVCxJQUFpQyxLQUF6Qzs7QUFFQSw0QkFBSSxLQUFKLEVBQVc7QUFDUCxtQ0FBTyxTQUFQLEdBQW1CLEtBQW5CO0FBQ0g7QUFDSixxQkFSTSxNQVFBLElBQUkseUJBQXlCLElBQXpCLENBQThCLFNBQTlCLEtBQTRDLFdBQVcsSUFBM0QsRUFBaUU7QUFDcEUsK0JBQU8sZUFBUCxHQUF5QixXQUFXLElBQXBDO0FBQ0g7QUFDSixpQkE1ZHlCO0FBNmQxQixzQkE3ZDBCLGtCQTZkbEIsSUE3ZGtCLEVBNmRaO0FBQ1YsZ0NBQVksSUFBWixDQUFpQixJQUFqQixDQUFzQixJQUF0QjtBQUNIO0FBL2R5QixhQUFoQixFQWdlWDtBQUNDLGdDQUFnQixJQURqQjtBQUVDLCtCQUFlLEtBRmhCO0FBR0Msc0NBQXNCO0FBSHZCLGFBaGVXLENBQWQ7QUFxZUgsU0F0aEJNLENBQVA7QUF1aEJILEtBNWtCNEI7Ozs7OztBQWlsQjdCLFFBQUksVUFBSixHQUFrQjtBQUNkLGVBQU8sS0FBSyxXQUFaO0FBQ0gsS0FubEI0Qjs7Ozs7Ozs7O0FBNGxCN0IsU0E1bEI2Qix3QkErbEIxQixnQkEvbEIwQixFQStsQlI7QUFBQSxZQUZqQixRQUVpQixTQUZqQixRQUVpQjtBQUFBLFlBRGpCLFFBQ2lCLFNBRGpCLFFBQ2lCOztBQUNqQixZQUFJLEtBQUssV0FBTCxJQUFvQixLQUFLLFFBQTdCLEVBQXVDO0FBQ25DLHdDQUFhLGdCQUFiO0FBQ0EsbUJBQU8sSUFBUDtBQUNIOztBQUVELGVBQU8sS0FBSyxRQUFMLENBQWM7QUFDakIsMkJBQWUsSUFERTtBQUVqQixpQkFBSyxLQUFLO0FBRk8sU0FBZCxFQUdKLENBQUMsS0FBRCxFQUFRLFlBQVIsS0FBeUI7QUFDeEIsZ0JBQUksS0FBSixFQUFXO0FBQ1AsaUNBQWlCLDhCQUFPO0FBQ3BCO0FBRG9CLGlCQUFQLENBQWpCO0FBR0E7QUFDSDs7QUFFRCxnQkFBSSxhQUFhLFVBQWIsS0FBNEIsR0FBNUIsSUFBbUMsT0FBTyxhQUFhLE9BQWIsQ0FBcUIsUUFBNUIsS0FBeUMsUUFBaEYsRUFBMEY7QUFDdEYsaUNBQWlCLDhCQUFPO0FBQ3BCLDZCQUFTO0FBQ0wsa0NBQVU7QUFETCxxQkFEVztBQUlwQiw2QkFBUztBQUpXLGlCQUFQLENBQWpCO0FBTUE7QUFDSDs7QUFFRCxrQkFBTSxXQUFXLGdCQUFVLGFBQWEsT0FBYixDQUFxQixRQUEvQixFQUF5QyxJQUF6QyxDQUFqQjtrQkFDSSxRQUFRLFNBQVMsS0FEckI7O0FBR0EsZ0JBQUksQ0FBQyxTQUFTLFFBQVYsSUFBc0IsQ0FBQyxTQUFTLFFBQWhDLElBQTRDLENBQUMsS0FBN0MsSUFBc0QsQ0FBQyxNQUFNLFNBQTdELElBQTBFLENBQUMsTUFBTSxZQUFqRixJQUFpRyxDQUFDLE1BQU0sYUFBeEcsSUFBeUgsQ0FBQyxNQUFNLEtBQXBJLEVBQTJJO0FBQ3ZJLGlDQUFpQiw4QkFBTztBQUNwQiw2QkFBUztBQUNMLGtDQUFVO0FBREwscUJBRFc7QUFJcEIsNkJBQVM7QUFKVyxpQkFBUCxDQUFqQjtBQU1BO0FBQ0g7O0FBRUQsaUJBQUssUUFBTCxDQUFjO0FBQ1Ysc0JBQU0sNEJBQWdCLHNCQUFjLEtBQWQsRUFBcUI7QUFDdkMsMEJBQU0sS0FBSyxLQUQ0QjtBQUV2QywyQ0FBdUIsRUFGZ0IsRTtBQUd2Qyx3Q0FBb0IsRUFIbUIsRTtBQUl2QyxzQ0FKdUM7QUFLdkMsMkJBQU8sRUFMZ0M7QUFNdkM7QUFOdUMsaUJBQXJCLENBQWhCLENBREk7QUFTVix5QkFBUztBQUNMLDZCQUFTO0FBQ0wsd0NBQWdCLG1DQURYO0FBRUwsaUNBQVMsYUFBYSxPQUFiLENBQXFCO0FBRnpCLHFCQURKO0FBS0wsOEJBQVUsU0FBUyxRQUxkO0FBTUwsNEJBQVEsTUFOSDtBQU9MLDBCQUFNLFNBQVM7QUFQVixpQkFUQztBQWtCViw2QkFBYSxLQWxCSDtBQW1CViwrQkFBZTtBQW5CTCxhQUFkLEVBb0JHLENBQUMsS0FBRCxFQUFRLGFBQVIsS0FBMEI7QUFDekIsb0JBQUksS0FBSixFQUFXO0FBQ1AscUNBQWlCLDhCQUFPO0FBQ3BCO0FBRG9CLHFCQUFQLENBQWpCO0FBR0E7QUFDSDs7QUFFRCxvQkFBSSxjQUFjLFVBQWQsS0FBNkIsR0FBN0IsSUFBb0MsT0FBTyxjQUFjLE9BQWQsQ0FBc0IsUUFBN0IsS0FBMEMsUUFBbEYsRUFBNEY7QUFDeEYscUNBQWlCLDhCQUFPO0FBQ3BCLGlDQUFTO0FBQ0wsc0NBQVU7QUFETCx5QkFEVztBQUlwQixpQ0FBUztBQUpXLHFCQUFQLENBQWpCO0FBTUE7QUFDSDs7QUFFRCxxQkFBSyxRQUFMLENBQWM7QUFDViw2QkFBUztBQUNMLGlDQUFTO0FBQ0wscUNBQVMsYUFBYSxPQUFiLENBQXFCO0FBRHpCO0FBREoscUJBREM7QUFNVixpQ0FBYSxJQU5IO0FBT1YsbUNBQWUsSUFQTDtBQVFWLHlCQUFLLGNBQWMsT0FBZCxDQUFzQjtBQVJqQixpQkFBZCxFQVNHLFNBQVM7QUFDUix3QkFBSSxLQUFKLEVBQVc7QUFDUCx5Q0FBaUIsOEJBQU87QUFDcEI7QUFEb0IseUJBQVAsQ0FBakI7QUFHQTtBQUNIOztBQUVELHlCQUFLLFdBQUwsR0FBbUIsSUFBbkI7O0FBRUE7QUFDSCxpQkFwQkQ7QUFxQkgsYUEzREQ7QUE0REgsU0E5Rk0sQ0FBUDtBQStGSCxLQXBzQjRCOzs7Ozs7QUF5c0I3QixVQXpzQjZCLG9CQXlzQm5CO0FBQ04sYUFBSyxXQUFMLEdBQW1CLEtBQW5CO0FBQ0EsYUFBSyxRQUFMLEdBQWdCLEVBQWhCO0FBQ0EsZUFBTyxJQUFQO0FBQ0gsS0E3c0I0Qjs7Ozs7Ozs7Ozs7QUF1dEI3QixvQkF2dEI2QixtQ0EwdEIxQixnQkExdEIwQixFQTB0QlI7QUFBQSxZQUZqQixRQUVpQixTQUZqQixRQUVpQjtBQUFBLFlBRGpCLFNBQ2lCLFNBRGpCLFNBQ2lCOztBQUNqQixZQUFJLENBQUMsS0FBSyxXQUFWLEVBQXVCO0FBQ25CLHdDQUFhLGdCQUFiLEVBQStCLDhCQUFPO0FBQ2xDLHlCQUFTO0FBRHlCLGFBQVAsQ0FBL0I7QUFHQSxtQkFBTyxJQUFQO0FBQ0g7O0FBRUQsZUFBTyxLQUFLLFFBQUwsQ0FBYztBQUNqQixxQkFBUztBQUNMLHlCQUFTO0FBQ0wscUJBQUMsS0FBSyxvQkFBTixHQUE2QjtBQUR4QixpQkFESjtBQUlMLHdCQUFRO0FBSkgsYUFEUTtBQU9qQixpQkFBSyxLQUFLLHVCQUFMLENBQTZCLFFBQTdCO0FBUFksU0FBZCxFQVFKLENBQUMsS0FBRCxFQUFRLFFBQVIsS0FBcUI7QUFDcEIsZ0JBQUksS0FBSixFQUFXO0FBQ1AsaUNBQWlCLDhCQUFPO0FBQ3BCO0FBRG9CLGlCQUFQLENBQWpCO0FBR0gsYUFKRCxNQUlPLElBQUksU0FBUyxVQUFULEtBQXdCLEdBQXhCLElBQStCLFNBQVMsVUFBVCxLQUF3QixHQUEzRCxFQUFnRTtBQUNuRTtBQUNILGFBRk0sTUFFQTtBQUNILGlDQUFpQiw4QkFBTztBQUNwQiw2QkFBUztBQUNMO0FBREsscUJBRFc7QUFJcEIsNkJBQVM7QUFKVyxpQkFBUCxDQUFqQjtBQU1IO0FBQ0osU0F2Qk0sQ0FBUDtBQXdCSCxLQTF2QjRCOzs7Ozs7OztBQWl3QjdCLHlCQWp3QjZCLGlDQWl3Qk4sUUFqd0JNLEVBaXdCSTtBQUM3QixlQUFPLENBQUMsQUFBRCxHQUFHLEtBQUssYUFBTCxDQUFtQixRQUFuQixDQUFILEVBQWdDLGNBQWhDLENBQVA7QUFDSCxLQW53QjRCOzs7Ozs7OztBQTB3QjdCLDJCQTF3QjZCLG1DQTB3QkosUUExd0JJLEVBMHdCTTtBQUMvQixlQUFPLENBQUMsQUFBRCxHQUFHLEtBQUssMkJBQVIsRUFBb0MsV0FBcEMsR0FBaUQsUUFBakQsRUFBMEQsQUFBMUQsQ0FBUDtBQUNILEtBNXdCNEI7Ozs7Ozs7O0FBbXhCN0IsaUJBbnhCNkIseUJBbXhCZCxRQW54QmMsRUFteEJKO0FBQ3JCLGVBQU8sQ0FBQyxBQUFELEdBQUcsS0FBSywyQkFBUixFQUFvQyxTQUFwQyxHQUErQyxRQUEvQyxFQUF3RCxBQUF4RCxDQUFQO0FBQ0gsS0FyeEI0Qjs7Ozs7Ozs7QUE0eEI3QixTQTV4QjZCLG1CQXd5QnJCO0FBQUEsMEVBQUosRUFBSTs7QUFBQSwwQ0FYSixtQkFXSTtBQUFBLFlBWEosbUJBV0kseUNBWGtCLGNBV2xCO0FBQUEscUNBVkosVUFVSTtBQUFBLFlBVkosVUFVSSxvQ0FWUztBQUNULGdCQUFJLGdCQURLO0FBRVQsaUJBQUssaUJBRkk7QUFHVCxpQkFBSyxvQkFISTtBQUlULGdCQUFJO0FBSkssU0FVVDtBQUFBLCtCQUpKLElBSUk7QUFBQSxZQUpKLElBSUksOEJBSkcsT0FJSDtBQUFBLDBDQUhKLGlCQUdJO0FBQUEsWUFISixpQkFHSSx5Q0FIZ0Isa0NBR2hCO0FBQUEsMENBRkosc0JBRUk7QUFBQSxZQUZKLHNCQUVJLHlDQUZxQixrRUFFckI7QUFBQSwyQ0FESiwwQkFDSTtBQUFBLFlBREosMEJBQ0ksMENBRHlCLDhDQUN6Qjs7QUFDSixhQUFLLG9CQUFMLEdBQTRCLG1CQUE1QjtBQUNBLGFBQUssV0FBTCxHQUFtQixVQUFuQjtBQUNBLGFBQUssV0FBTCxHQUFtQixLQUFuQjtBQUNBLGFBQUssS0FBTCxHQUFhLElBQWI7QUFDQSxhQUFLLGtCQUFMLEdBQTBCLEtBQTFCO0FBQ0EsYUFBSyxhQUFMLEdBQXFCLEVBQXJCO0FBQ0EsYUFBSyxRQUFMLEdBQWdCLEVBQWhCO0FBQ0EsYUFBSyxrQkFBTCxHQUEwQixpQkFBMUI7QUFDQSxhQUFLLHVCQUFMLEdBQStCLHNCQUEvQjtBQUNBLGFBQUssMkJBQUwsR0FBbUMsMEJBQW5DO0FBQ0EsZUFBTyxJQUFQO0FBQ0gsS0FwekI0Qjs7Ozs7Ozs7Ozs7Ozs7QUFpMEI3QixZQWowQjZCLDJCQXUwQjFCLGdCQXYwQjBCLEVBdTBCUjtBQUFBLFlBTGpCLElBS2lCLFNBTGpCLElBS2lCO0FBQUEsa0NBSmpCLE9BSWlCO0FBQUEsWUFKakIsT0FJaUIsaUNBSlAsRUFJTztBQUFBLFlBSGpCLFdBR2lCLFNBSGpCLFdBR2lCO0FBQUEsWUFGakIsYUFFaUIsU0FGakIsYUFFaUI7QUFBQSxZQURqQixHQUNpQixTQURqQixHQUNpQjs7QUFDakIsWUFBSSxLQUFLLGtCQUFULEVBQTZCO0FBQ3pCLGlCQUFLLGFBQUwsQ0FBbUIsSUFBbkIsQ0FBd0I7QUFDcEIsa0RBRG9CO0FBRXBCLGdDQUZvQjtBQUdwQjtBQUhvQixhQUF4Qjs7QUFNQSxtQkFBTyxJQUFQO0FBQ0g7O0FBRUQsYUFBSyxrQkFBTCxHQUEwQixJQUExQjs7QUFFQSxZQUFJLFFBQUo7O0FBRUEsWUFBSSxPQUFPLFdBQVAsS0FBdUIsV0FBM0IsRUFBd0M7QUFDcEMsMEJBQWMsS0FBSyxXQUFuQjtBQUNIOztBQUVELFlBQUksT0FBTyxhQUFQLEtBQXlCLFdBQTdCLEVBQTBDO0FBQ3RDLDRCQUFnQixLQUFLLFdBQXJCO0FBQ0g7O0FBRUQsWUFBSSxXQUFKLEVBQWlCO0FBQ2IsZ0JBQUksVUFBVSxRQUFRLE9BQXRCOztBQUVBLGdCQUFJLENBQUMsT0FBTCxFQUFjO0FBQ1YsMEJBQVUsRUFBVjtBQUNBLHdCQUFRLE9BQVIsR0FBa0IsT0FBbEI7QUFDSDs7QUFFRCxnQkFBSSxRQUFRLE1BQVosRUFBb0I7QUFDaEIsb0JBQUksSUFBSSxNQUFKLENBQVcsQ0FBQyxBQUFELEdBQUcsS0FBSyxrQkFBUixFQUEyQixXQUEzQixDQUFYLEVBQW9ELElBQXBELENBQXlELFFBQVEsTUFBakUsQ0FBSixFQUE4RTtBQUMxRSw0QkFBUSxNQUFSLEdBQWlCLFFBQVEsTUFBUixDQUFlLE9BQWYsQ0FBdUIsSUFBSSxNQUFKLENBQVcsQ0FBQyxBQUFELEdBQUcsS0FBSyxrQkFBUixFQUEyQixTQUEzQixDQUFYLENBQXZCLEVBQTBFLENBQUMsQUFBRCxHQUFHLEtBQUssa0JBQVIsRUFBMkIsQ0FBM0IsR0FBOEIsS0FBSyxRQUFuQyxFQUE0QyxFQUE1QyxDQUExRSxDQUFqQjtBQUNILGlCQUZELE1BRU87QUFDSCw0QkFBUSxNQUFSLElBQWtCLENBQUMsRUFBRCxHQUFLLEtBQUssa0JBQVYsRUFBNkIsQ0FBN0IsR0FBZ0MsS0FBSyxRQUFyQyxFQUE4QyxBQUE5QyxDQUFsQjtBQUNIO0FBQ0osYUFORCxNQU1PO0FBQ0gsd0JBQVEsTUFBUixHQUFpQixDQUFDLEFBQUQsR0FBRyxLQUFLLGtCQUFSLEVBQTJCLENBQTNCLEdBQThCLEtBQUssUUFBbkMsRUFBNEMsQUFBNUMsQ0FBakI7QUFDSDtBQUNKOztBQUVELGNBQU0sbUJBQW1CLENBQUMsS0FBRCxFQUFRLFFBQVIsS0FBcUI7QUFDdEMsZ0JBQUksUUFBSixFQUFjO0FBQ1Y7QUFDSDs7QUFFRCxpQkFBSyxrQkFBTCxHQUEwQixLQUExQjtBQUNBLHVCQUFXLElBQVg7O0FBRUEsZ0JBQUksS0FBSixFQUFXO0FBQ1AsaUNBQWlCLDhCQUFPO0FBQ3BCLDZCQUFTO0FBQ0wsa0NBREs7QUFFTCx3Q0FGSztBQUdMLGdEQUhLO0FBSUwsb0RBSks7QUFLTDtBQUxLLHFCQURXO0FBUXBCLGdDQVJvQjtBQVNwQiw2QkFBUztBQVRXLGlCQUFQLENBQWpCO0FBV0gsYUFaRCxNQVlPO0FBQ0gsaUNBQWlCLElBQWpCLEVBQXVCLFFBQXZCO0FBQ0g7O0FBRUQsa0JBQU0sT0FBTyxLQUFLLGFBQUwsQ0FBbUIsS0FBbkIsRUFBYjs7QUFFQSxnQkFBSSxJQUFKLEVBQVU7QUFDTixxQkFBSyxRQUFMLENBQWMsSUFBZCxFQUFvQixLQUFLLGdCQUF6QjtBQUNIO0FBQ0osU0E3Qkw7Y0E4QkksVUFBVSxvQkFBUyxNQUFNLHNCQUFjLGdCQUFVLEdBQVYsQ0FBZCxFQUE4QixPQUE5QixDQUFOLEdBQStDLE9BQXhELEVBQWlFLFlBQVk7QUFDbkYsZ0JBQUksQ0FBQyxhQUFELElBQWtCLE1BQU0sT0FBTixDQUFjLFNBQVMsT0FBVCxDQUFpQixZQUFqQixDQUFkLEtBQWlELFNBQVMsT0FBVCxDQUFpQixZQUFqQixFQUErQixJQUEvQixDQUFvQyxVQUFVO0FBQ2pILHNCQUFNLFFBQVEsT0FBTyxLQUFQLENBQWEsSUFBSSxNQUFKLENBQVcsQ0FBQyxBQUFELEdBQUcsS0FBSyxrQkFBUixFQUEyQixPQUEzQixDQUFYLENBQWIsQ0FBZDs7QUFFQSxvQkFBSSxLQUFKLEVBQVc7QUFDUCx5QkFBSyxRQUFMLEdBQWdCLE1BQU0sQ0FBTixDQUFoQjtBQUNBLDJCQUFPLElBQVA7QUFDSDs7QUFFRCx1QkFBTyxLQUFQO0FBQ0gsYUFUc0UsQ0FBdkUsRUFTSTtBQUNBLGlDQUFpQixJQUFqQixFQUF1QixRQUF2QjtBQUNILGFBWEQsTUFXTztBQUNILGlDQUFpQiw4QkFBTztBQUNwQiw2QkFBUztBQURXLGlCQUFQLENBQWpCO0FBR0g7QUFDSixTQWpCUyxDQTlCZDs7QUFpREEsZ0JBQVEsRUFBUixDQUFXLE9BQVgsRUFBb0IsU0FBUztBQUN6Qiw2QkFBaUIsOEJBQU87QUFDcEI7QUFEb0IsYUFBUCxDQUFqQjtBQUdILFNBSkQ7O0FBTUEsZ0JBQVEsR0FBUixDQUFZLElBQVo7O0FBRUEsZUFBTyxJQUFQO0FBQ0g7QUEzNkI0QixDQUFOLENBQS9COzs7Ozs7OztBQW03QkksZUFBZSxTQUFmLFlBQWUsR0FBbUI7QUFBQSxzQ0FBTixJQUFNO0FBQU4sWUFBTTtBQUFBOztBQUM5Qix5QkFBYyx1QkFBdUIsU0FBdkIsQ0FBaUMsV0FBL0MsRUFBNEQsd0JBQTVELEVBQXNGLElBQXRGO0FBQ0gsQ0FyN0JMOzs7Ozs7Ozs7O0FBODdCSSxTQUFTLFNBQVQsTUFBUyxDQUFVLE1BQVYsRUFBa0IsZ0JBQWxCLEVBQW9DO0FBQ3pDLFVBQU0sd0JBQXdCLHlCQUF5QixLQUF6QixDQUErQixNQUEvQixFQUF1QyxTQUFTO0FBQzFFLFlBQUksS0FBSixFQUFXO0FBQ1AsNkJBQWlCLDhCQUFPO0FBQ3BCO0FBRG9CLGFBQVAsQ0FBakI7QUFHSCxTQUpELE1BSU87QUFDSCw2QkFBaUIsSUFBakIsRUFBdUIscUJBQXZCO0FBQ0g7QUFDSixLQVI2QixDQUE5QjtBQVNILENBeDhCTDs7UUEyOEJvQixXLEdBQWhCLFk7UUFDVSxLLEdBQVYsTTtRQUMwQixPLEdBQTFCLHNCIiwiZmlsZSI6InN1cGVyLW1hcmlvLW1ha2VyLWNsaWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuQG1vZHVsZSBzdXBlci1tYXJpby1tYWtlci1jbGllbnRcbkBhdXRob3IgU3RldmVuIE9sbXN0ZWQgPHN0ZXZlbi5vbG1AZ21haWwuY29tPlxuKi9cblxuLyoqXG5AY2FsbGJhY2sgQ291cnNlQ2FsbGJhY2tcbkBhcmcge0Vycm9yfSBlcnJvclxuQGFyZyB7T2JqZWN0fSBjb3Vyc2VcbiovXG5cbi8qKlxuQGNhbGxiYWNrIEVycm9yQ2FsbGJhY2tcbkBhcmcge0Vycm9yfSBlcnJvclxuKi9cblxuLyoqXG5AY2FsbGJhY2sgSW5jb21pbmdNZXNzYWdlQ2FsbGJhY2tcbkBhcmcge0Vycm9yfSBlcnJvclxuQGFyZyB7SW5jb21pbmdNZXNzYWdlfSByZXNwb25zZVxuKi9cblxuLyoqXG5AY2FsbGJhY2sgU3VwZXJNYXJpb01ha2VyQ2xpZW50Q2FsbGJhY2tcbkBhcmcge0Vycm9yfSBlcnJvclxuQGFyZyB7U3VwZXJNYXJpb01ha2VyQ2xpZW50fSBzdXBlck1hcmlvTWFrZXJDbGllbnRcbiovXG5cbmltcG9ydCBfRXJyb3IgZnJvbSAnaXNvdHJvcGljLWVycm9yJztcblxuaW1wb3J0IHtcbiAgICBQYXJzZXIgYXMgX0h0bWxQYXJzZXJcbn0gZnJvbSAnaHRtbHBhcnNlcjInO1xuXG5pbXBvcnQgX21ha2UgZnJvbSAnaXNvdHJvcGljLW1ha2UnO1xuXG5pbXBvcnQge1xuICAgIHBhcnNlIGFzIF9wYXJzZVVybFxufSBmcm9tICd1cmwnO1xuXG5pbXBvcnQge1xuICAgIHJlcXVlc3QgYXMgX3JlcXVlc3Rcbn0gZnJvbSAnaHR0cHMnO1xuXG5pbXBvcnQge1xuICAgIHN0cmluZ2lmeSBhcyBfc3RyaW5naWZ5UXVlcnlcbn0gZnJvbSAncXVlcnlzdHJpbmcnO1xuXG4vKipcbkBjbGFzcyBTdXBlck1hcmlvTWFrZXJDbGllbnRcbkBhcmcge09iamVjdH0gW2NvbmZpZ11cbkBhcmcge1N0cmluZ30gW2NvbmZpZy5jc3JmVG9rZW5IZWFkZXJOYW1lPSdYLUNTUkYtVG9rZW4nXVxuQGFyZyB7T2JqZWN0fSBbY29uZmlnLmdhbWVTdHlsZXM9e3NiOiAnc3VwZXJNYXJpb0Jyb3MnLHNiMzogJ3N1cGVyTWFyaW9Ccm9zMycsc2J1OiAnbmV3U3VwZXJNYXJpb0Jyb3NVJyxzdzogJ3N1cGVyTWFyaW9Xb3JsZCd9XVxuQGFyZyB7U3RyaW5nfSBbY29uZmlnLmxhbmc9J2VuLVVTJ11cbkBhcmcge1N0cmluZ30gW2NvbmZpZy5zZXNzaW9uQ29va2llTmFtZT0nX3N1cGVybWFyaW9tYWtlcmJvb2ttYXJrX3Nlc3Npb24nXVxuQGFyZyB7U3RyaW5nfSBbY29uZmlnLnN1cGVyTWFyaW9NYWtlckF1dGhVcmw9J2h0dHBzOi8vc3VwZXJtYXJpb21ha2VyYm9va21hcmsubmludGVuZG8ubmV0L3VzZXJzL2F1dGgvbmludGVuZG8nXVxuQGFyZyB7U3RyaW5nfSBbY29uZmlnLnN1cGVyTWFyaW9NYWtlckJvb2ttYXJrVXJsPSdodHRwczovL3N1cGVybWFyaW9tYWtlcmJvb2ttYXJrLm5pbnRlbmRvLm5ldCddXG4qL1xuY29uc3QgX1N1cGVyTWFyaW9NYWtlckNsaWVudCA9IF9tYWtlKHtcbiAgICAgICAgLyoqXG4gICAgICAgIEBtZXRob2QgbW9kdWxlOnN1cGVyLW1hcmlvLW1ha2VyLWNsaWVudH5TdXBlck1hcmlvTWFrZXJDbGllbnQjYm9va21hcmtDb3Vyc2VcbiAgICAgICAgQGFyZyB7T2JqZWN0fSBjb25maWdcbiAgICAgICAgQGFyZyB7U3RyaW5nfSBjb25maWcuY291cnNlSWRcbiAgICAgICAgQGFyZyB7U3RyaW5nfSBjb25maWcuY3NyZlRva2VuXG4gICAgICAgIEBhcmcge0Vycm9yQ2FsbGJhY2t9IGNhbGxiYWNrRnVuY3Rpb25cbiAgICAgICAgQGluc3RhbmNlXG4gICAgICAgIEByZXR1cm5zIHt0aGlzfVxuICAgICAgICAqL1xuICAgICAgICBib29rbWFya0NvdXJzZSAoe1xuICAgICAgICAgICAgY291cnNlSWQsXG4gICAgICAgICAgICBjc3JmVG9rZW5cbiAgICAgICAgfSwgY2FsbGJhY2tGdW5jdGlvbikge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0xvZ2dlZEluKSB7XG4gICAgICAgICAgICAgICAgc2V0SW1tZWRpYXRlKGNhbGxiYWNrRnVuY3Rpb24sIF9FcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdOb3QgbG9nZ2VkIGluLidcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFt0aGlzLl9jc3JmVG9rZW5IZWFkZXJOYW1lXTogY3NyZlRva2VuXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuX2dldENvdXJzZUJvb2ttYXJrVXJsKGNvdXJzZUlkKVxuICAgICAgICAgICAgfSwgKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja0Z1bmN0aW9uKF9FcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvclxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24oX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gYm9va21hcmsgY291cnNlLidcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgQG1ldGhvZCBtb2R1bGU6c3VwZXItbWFyaW8tbWFrZXItY2xpZW50flN1cGVyTWFyaW9NYWtlckNsaWVudCNmZXRjaENvdXJzZVxuICAgICAgICBAYXJnIHtTdHJpbmd9IGNvdXJzZUlkXG4gICAgICAgIEBhcmcge0NvdXJzZUNhbGxiYWNrfSBjYWxsYmFja0Z1bmN0aW9uXG4gICAgICAgIEByZXR1cm5zIHt0aGlzfVxuICAgICAgICAqL1xuICAgICAgICBmZXRjaENvdXJzZSAoY291cnNlSWQsIGNhbGxiYWNrRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuX2dldENvdXJzZVVybChjb3Vyc2VJZClcbiAgICAgICAgICAgIH0sIChlcnJvciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbihfRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja0Z1bmN0aW9uKF9FcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQ291cnNlIHJlcXVlc3QgZmFpbGVkLidcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGV0IGNvbXBsZXRlLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3Jvb3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogW11cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlRnVuY3Rpb24gPSAoZXJyb3IsIGNvdXJzZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24oX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdIVE1MIHBhcnNlIGVycm9yLidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24obnVsbCwgY291cnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY291cnNlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlSWRcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2FtZVN0eWxlcyA9IHRoaXMuX2dhbWVTdHlsZXM7XG5cbiAgICAgICAgICAgICAgICByZXNwb25zZS5waXBlKG5ldyBfSHRtbFBhcnNlcih7XG4gICAgICAgICAgICAgICAgICAgIG9uY2xvc2V0YWcgKG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5uYW1lICE9PSBuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVGdW5jdGlvbihfRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdDbG9zaW5nIHRhZyBoYWQgbm8gbWF0Y2hpbmcgb3BlbiB0YWcuJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnVucGlwZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gY3VycmVudE5vZGUuYXR0cmlidXRlcy5jbGFzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZWROb2RlID0gY3VycmVudE5vZGU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gY3VycmVudE5vZGUucGFyZW50O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC8oPzpefCApY2xlYXItcmF0ZSg/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaWdpdHMgPSAnJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlZE5vZGUuY2hpbGRyZW4uZm9yRWFjaChjaGlsZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBjaGlsZE5vZGUuYXR0cmlidXRlcy5jbGFzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gY2xhc3NOYW1lICYmIGNsYXNzTmFtZS5tYXRjaCgvKD86XnwgKXR5cG9ncmFwaHktKFxcZHxzZWNvbmQpKD86IHwkKS8pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaFsxXSA9PT0gJ3NlY29uZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZ2l0cyArPSAnLic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWdpdHMgKz0gbWF0Y2hbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWdpdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLmNsZWFyUmF0ZSA9ICtkaWdpdHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKWNsZWFyLXRpbWUoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGlnaXRzID0gJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZWROb2RlLmNoaWxkcmVuLmZvckVhY2goY2hpbGROb2RlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gY2hpbGROb2RlLmF0dHJpYnV0ZXMuY2xhc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGNsYXNzTmFtZSAmJiBjbGFzc05hbWUubWF0Y2goLyg/Ol58ICl0eXBvZ3JhcGh5LShcXGR8bWludXRlfHNlY29uZCkoPzogfCQpLyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoWzFdID09PSAnbWludXRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZ2l0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSArZGlnaXRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZ2l0cyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoWzFdID09PSAnc2Vjb25kJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZ2l0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHMgPSArZGlnaXRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZ2l0cyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlnaXRzICs9IG1hdGNoWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlnaXRzIHx8IG1pbnV0ZXMgfHwgc2Vjb25kcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGlzdGFuY2UgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGNsb3NlZE5vZGUucGFyZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ybGRSZWNvcmQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IChtaW51dGVzIHx8IDApICogNjAwMDAgKyAoc2Vjb25kcyB8fCAwKSAqIDEwMDAgKyAoK2RpZ2l0cyB8fCAwKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobm9kZSAmJiBkaXN0YW5jZSA8IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IG5vZGUuYXR0cmlidXRlcy5jbGFzcztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSAmJiAvKD86XnwgKWZhc3Rlc3QtdXNlcig/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkUmVjb3JkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3b3JsZFJlY29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ybGRSZWNvcmQgPSBjb3Vyc2Uud29ybGRSZWNvcmQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghd29ybGRSZWNvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JsZFJlY29yZCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS53b3JsZFJlY29yZCA9IHdvcmxkUmVjb3JkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JsZFJlY29yZC50aW1lID0gdGltZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS55b3VyQmVzdFRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKWNvdXJzZS1kZXRhaWwtd3JhcHBlcig/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlZE5vZGUuY2hpbGRyZW4uZm9yRWFjaChjaGlsZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBjaGlsZE5vZGUuYXR0cmlidXRlcy5jbGFzcztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC8oPzpefCApY3JlYXRvcig/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluZEltZ1NyYyA9IGNoaWxkTm9kZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZE5vZGUubmFtZSA9PT0gJ2ltZycgJiYgY2hpbGROb2RlLmF0dHJpYnV0ZXMuc3JjKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGROb2RlLmF0dHJpYnV0ZXMuc3JjO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGltZ1NyYztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZE5vZGUuY2hpbGRyZW4uc29tZShjaGlsZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nU3JjID0gZmluZEltZ1NyYyhjaGlsZE5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGltZ1NyYztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGltZ1NyYztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZ1NyYyA9IGZpbmRJbWdTcmMoY2hpbGROb2RlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbWdTcmMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjcmVhdG9yID0gY291cnNlLmNyZWF0b3I7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY3JlYXRvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0b3IgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UuY3JlYXRvciA9IGNyZWF0b3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0b3IubWlpSWNvblVybCA9IGltZ1NyYztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKWNyZWF0b3ItaW5mbyg/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNyZWF0b3IgPSBjb3Vyc2UuY3JlYXRvcjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjcmVhdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRvciA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS5jcmVhdG9yID0gY3JlYXRvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGROb2RlLmNoaWxkcmVuLmZvckVhY2goY2hpbGROb2RlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBjaGlsZE5vZGUuYXR0cmlidXRlcy5jbGFzcztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLyg/Ol58IClmbGFnKD86IHwkKS8udGVzdChjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50cnkgPSBjbGFzc05hbWUuc3BsaXQoJyAnKS5maWx0ZXIoY2xhc3NOYW1lID0+IGNsYXNzTmFtZSAhPT0gJ2ZsYWcnKVswXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRvci5jb3VudHJ5ID0gY291bnRyeTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoLyg/Ol58ICltZWRhbHMoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1hdGNoID0gY2xhc3NOYW1lLm1hdGNoKC8oPzpefCApY29tbW9uX2ljb25fY29pbihcXGQrKSg/OiB8JCkvKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IG1hdGNoICYmIG1hdGNoWzFdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoID09PSAnMTEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpZ2l0cyA9ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGROb2RlLmNoaWxkcmVuLmZvckVhY2goY2hpbGROb2RlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gY2hpbGROb2RlLmF0dHJpYnV0ZXMuY2xhc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGNsYXNzTmFtZSAmJiBjbGFzc05hbWUubWF0Y2goLyg/Ol58ICl0eXBvZ3JhcGh5LShcXGQpKD86IHwkKS8pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlnaXRzICs9IG1hdGNoWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlnaXRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0b3IubWVkYWxzID0gK2RpZ2l0cztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0b3IubWVkYWxzID0gK21hdGNoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKW5hbWUoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGNoaWxkTm9kZS50ZXh0WzBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdG9yLm1paU5hbWUgPSB0ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoLyg/Ol58ICljb3Vyc2UtaGVhZGVyKD86IHwkKS8udGVzdChjbGFzc05hbWUpICYmIGNsb3NlZE5vZGUudGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaWZmaWN1bHR5ID0gY2xvc2VkTm9kZS50ZXh0LmpvaW4oJycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLmRpZmZpY3VsdHkgPSBkaWZmaWN1bHR5LmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgZGlmZmljdWx0eS5zdWJzdHIoMSkucmVwbGFjZSgvIC9nLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC8oPzpefCApY291cnNlLXRhZyg/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSAmJiBjbG9zZWROb2RlLnRleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFnID0gY2xvc2VkTm9kZS50ZXh0LmpvaW4oJycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhZyAmJiB0YWcgIT09ICctLS0nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS50YWcgPSB0YWc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKWNvdXJzZS10aXRsZSg/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSAmJiBjbG9zZWROb2RlLnRleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLnRpdGxlID0gY2xvc2VkTm9kZS50ZXh0LmpvaW4oJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKWNyZWF0ZWRfYXQoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkgJiYgY2xvc2VkTm9kZS50ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNyZWF0ZWRBdCA9IGNsb3NlZE5vZGUudGV4dC5qb2luKCcnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBjcmVhdGVkQXQubWF0Y2goL14oXFxkKykgKGRheXxob3VyKXM/IGFnbyQvKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS5jcmVhdGVkQXQgPSBjcmVhdGVkQXQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1pbGxpc2Vjb25kc0FnbztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1hdGNoWzJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbGxpc2Vjb25kc0FnbyA9IDg2NDAwMDAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaG91cic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWlsbGlzZWNvbmRzQWdvID0gMzYwMDAwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLnVwbG9hZERhdGUgPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIG1hdGNoWzFdICogbWlsbGlzZWNvbmRzQWdvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWREYXRlID0gbmV3IERhdGUoY3JlYXRlZEF0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc05hTih1cGxvYWREYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS51cGxvYWREYXRlID0gdXBsb2FkRGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoLyg/Ol58IClsaWtlZC1jb3VudCg/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaWdpdHMgPSAnJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlZE5vZGUuY2hpbGRyZW4uZm9yRWFjaChjaGlsZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBjaGlsZE5vZGUuYXR0cmlidXRlcy5jbGFzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gY2xhc3NOYW1lICYmIGNsYXNzTmFtZS5tYXRjaCgvKD86XnwgKXR5cG9ncmFwaHktKFxcZCkoPzogfCQpLyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWdpdHMgKz0gbWF0Y2hbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWdpdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLnN0YXJzID0gK2RpZ2l0cztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC8oPzpefCApcGxheWVkLWNvdW50KD86IHwkKS8udGVzdChjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpZ2l0cyA9ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VkTm9kZS5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkTm9kZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IGNoaWxkTm9kZS5hdHRyaWJ1dGVzLmNsYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBjbGFzc05hbWUgJiYgY2xhc3NOYW1lLm1hdGNoKC8oPzpefCApdHlwb2dyYXBoeS0oXFxkKSg/OiB8JCkvKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZ2l0cyArPSBtYXRjaFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZ2l0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UucGxheWVycyA9ICtkaWdpdHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKXNoYXJlZC1jb3VudCg/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaWdpdHMgPSAnJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlZE5vZGUuY2hpbGRyZW4uZm9yRWFjaChjaGlsZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBjaGlsZE5vZGUuYXR0cmlidXRlcy5jbGFzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gY2xhc3NOYW1lICYmIGNsYXNzTmFtZS5tYXRjaCgvKD86XnwgKXR5cG9ncmFwaHktKFxcZCkoPzogfCQpLyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWdpdHMgKz0gbWF0Y2hbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWdpdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLnR3ZWV0cyA9ICtkaWdpdHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKXRyaWVkLWNvdW50KD86IHwkKS8udGVzdChjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpZ2l0cyA9ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VkTm9kZS5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkTm9kZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IGNoaWxkTm9kZS5hdHRyaWJ1dGVzLmNsYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBjbGFzc05hbWUgJiYgY2xhc3NOYW1lLm1hdGNoKC8oPzpefCApdHlwb2dyYXBoeS0oXFxkfHNsYXNoKSg/OiB8JCkvKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hbMV0gPT09ICdzbGFzaCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWdpdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UuY2xlYXJzID0gK2RpZ2l0cztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWdpdHMgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZ2l0cyArPSBtYXRjaFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZ2l0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UuYXR0ZW1wdHMgPSArZGlnaXRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoLyg/Ol58ICl1c2VyLXdyYXBwZXIoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXIgPSB7fTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlZE5vZGUuY2hpbGRyZW4uZm9yRWFjaChjaGlsZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBjaGlsZE5vZGUuYXR0cmlidXRlcy5jbGFzcztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC8oPzpefCApbWlpLXdyYXBwZXIoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmRJbWdTcmMgPSBjaGlsZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLm5hbWUgPT09ICdpbWcnICYmIGNoaWxkTm9kZS5hdHRyaWJ1dGVzLnNyYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkTm9kZS5hdHRyaWJ1dGVzLnNyYztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbWdTcmM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGROb2RlLmNoaWxkcmVuLnNvbWUoY2hpbGROb2RlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZ1NyYyA9IGZpbmRJbWdTcmMoY2hpbGROb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbWdTcmM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbWdTcmM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdTcmMgPSBmaW5kSW1nU3JjKGNoaWxkTm9kZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbWdTcmMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubWlpSWNvblVybCA9IGltZ1NyYztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKXVzZXItaW5mbyg/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGROb2RlLmNoaWxkcmVuLmZvckVhY2goY2hpbGROb2RlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBjaGlsZE5vZGUuYXR0cmlidXRlcy5jbGFzcztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLyg/Ol58IClmbGFnKD86IHwkKS8udGVzdChjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50cnkgPSBjbGFzc05hbWUuc3BsaXQoJyAnKS5maWx0ZXIoY2xhc3NOYW1lID0+IGNsYXNzTmFtZSAhPT0gJ2ZsYWcnKVswXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmNvdW50cnkgPSBjb3VudHJ5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvKD86XnwgKW5hbWUoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGNoaWxkTm9kZS50ZXh0WzBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubWlpTmFtZSA9IHRleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3Qua2V5cyhwbGF5ZXIpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpc3RhbmNlID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGNsb3NlZE5vZGUucGFyZW50O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUgJiYgZGlzdGFuY2UgPCAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IG5vZGUuYXR0cmlidXRlcy5jbGFzcztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLyg/Ol58ICljbGVhcmVkLWJvZHkoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2xlYXJlZEJ5ID0gY291cnNlLmNsZWFyZWRCeTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2xlYXJlZEJ5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyZWRCeSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UuY2xlYXJlZEJ5ID0gY2xlYXJlZEJ5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyZWRCeS5wdXNoKHBsYXllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLyg/Ol58IClmYXN0ZXN0LXVzZXIoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgd29ybGRSZWNvcmQgPSBjb3Vyc2Uud29ybGRSZWNvcmQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXdvcmxkUmVjb3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkUmVjb3JkID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS53b3JsZFJlY29yZCA9IHdvcmxkUmVjb3JkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkUmVjb3JkLnBsYXllciA9IHBsYXllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgvKD86XnwgKWZpcnN0LXVzZXIoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UuZmlyc3RDbGVhckJ5ID0gcGxheWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC8oPzpefCApbGlrZWQtYm9keSg/OiB8JCkvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzdGFycmVkQnkgPSBjb3Vyc2Uuc3RhcnJlZEJ5O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFycmVkQnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnJlZEJ5ID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS5zdGFycmVkQnkgPSBzdGFycmVkQnk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnJlZEJ5LnB1c2gocGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgvKD86XnwgKXBsYXllZC1ib2R5KD86IHwkKS8udGVzdChjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlY2VudFBsYXllcnMgPSBjb3Vyc2UucmVjZW50UGxheWVycztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVjZW50UGxheWVycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlbnRQbGF5ZXJzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS5yZWNlbnRQbGF5ZXJzID0gcmVjZW50UGxheWVycztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlbnRQbGF5ZXJzLnB1c2gocGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbmVuZCAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZUZ1bmN0aW9uKG51bGwsIGNvdXJzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uZXJyb3IgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZUZ1bmN0aW9uKF9FcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25vcGVudGFnIChuYW1lLCBhdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSBhdHRyaWJ1dGVzLmNsYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50OiBjdXJyZW50Tm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogW11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5jaGlsZHJlbi5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBub2RlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlcy5uYW1lID09PSAnY3NyZi10b2tlbicgJiYgYXR0cmlidXRlcy5jb250ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLmNzcmZUb2tlbiA9IGF0dHJpYnV0ZXMuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjbGFzc05hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgvKD86XnwgKWNvdXJzZS1jbGVhci1mbGFnLXdyYXBwZXIoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UuY2xlYXJlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUgPT09ICdpbWcnICYmIGF0dHJpYnV0ZXMuc3JjICYmIC8oPzpefCApY291cnNlLWltYWdlKD86IHwkKS8udGVzdChjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLnRodW1ibmFpbFVybCA9IGF0dHJpYnV0ZXMuc3JjO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAnaW1nJyAmJiBhdHRyaWJ1dGVzLnNyYyAmJiAvKD86XnwgKWNvdXJzZS1pbWFnZS1mdWxsKD86IHwkKS8udGVzdChjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLmltYWdlVXJsID0gYXR0cmlidXRlcy5zcmM7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC8oPzpefCApZ2FtZXNraW4oPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWF0Y2ggPSBjbGFzc05hbWUubWF0Y2goLyg/Ol58ICljb21tb25fZ3NfKFtBLVphLXowLTldKykoPzogfCQpLyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IG1hdGNoICYmIGdhbWVTdHlsZXNbbWF0Y2hbMV1dIHx8IG1hdGNoO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZS5nYW1lU3R5bGUgPSBtYXRjaDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC8oPzpefCApbWlpdmVyc2UoPzogfCQpLy50ZXN0KGNsYXNzTmFtZSkgJiYgYXR0cmlidXRlcy5ocmVmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlLm1paXZlcnNlUG9zdFVybCA9IGF0dHJpYnV0ZXMuaHJlZjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb250ZXh0ICh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS50ZXh0LnB1c2godGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgIGRlY29kZUVudGl0aWVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsb3dlckNhc2VUYWdzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcmVjb2duaXplU2VsZkNsb3Npbmc6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgIEBtZW1iZXIge0Jvb2xlYW59IG1vZHVsZTpzdXBlci1tYXJpby1tYWtlci1jbGllbnR+U3VwZXJNYXJpb01ha2VyQ2xpZW50I2lzTG9nZ2VkSW5cbiAgICAgICAgQHJlYWRvbmx5XG4gICAgICAgICovXG4gICAgICAgIGdldCBpc0xvZ2dlZEluICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0xvZ2dlZEluO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgQG1ldGhvZCBtb2R1bGU6c3VwZXItbWFyaW8tbWFrZXItY2xpZW50flN1cGVyTWFyaW9NYWtlckNsaWVudCNsb2dJblxuICAgICAgICBAYXJnIHtPYmplY3R9IGNvbmZpZ1xuICAgICAgICBAYXJnIHtTdHJpbmd9IGNvbmZpZy5wYXNzd29yZFxuICAgICAgICBAYXJnIHtTdHJpbmd9IGNvbmZpZy51c2VybmFtZVxuICAgICAgICBAYXJnIHtFcnJvckNhbGxiYWNrfSBjYWxsYmFja0Z1bmN0aW9uXG4gICAgICAgIEByZXR1cm5zIHt0aGlzfVxuICAgICAgICAqL1xuICAgICAgICBsb2dJbiAoe1xuICAgICAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgICAgICB1c2VybmFtZVxuICAgICAgICB9LCBjYWxsYmFja0Z1bmN0aW9uKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faXNMb2dnZWRJbiAmJiB0aGlzLl9zZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgc2V0SW1tZWRpYXRlKGNhbGxiYWNrRnVuY3Rpb24pO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgdXBkYXRlU2Vzc2lvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuX3N1cGVyTWFyaW9NYWtlckF1dGhVcmxcbiAgICAgICAgICAgIH0sIChlcnJvciwgYXV0aFJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24oX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChhdXRoUmVzcG9uc2Uuc3RhdHVzQ29kZSAhPT0gMzAyIHx8IHR5cGVvZiBhdXRoUmVzcG9uc2UuaGVhZGVycy5sb2NhdGlvbiAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbihfRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlOiBhdXRoUmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU3VwZXIgTWFyaW8gTWFrZXIgYXV0aCByZXF1ZXN0IGZhaWxlZC4nXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gX3BhcnNlVXJsKGF1dGhSZXNwb25zZS5oZWFkZXJzLmxvY2F0aW9uLCB0cnVlKSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBsb2NhdGlvbi5xdWVyeTtcblxuICAgICAgICAgICAgICAgIGlmICghbG9jYXRpb24uaG9zdG5hbWUgfHwgIWxvY2F0aW9uLnBhdGhuYW1lIHx8ICFxdWVyeSB8fCAhcXVlcnkuY2xpZW50X2lkIHx8ICFxdWVyeS5yZWRpcmVjdF91cmkgfHwgIXF1ZXJ5LnJlc3BvbnNlX3R5cGUgfHwgIXF1ZXJ5LnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24oX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZTogYXV0aFJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1N1cGVyIE1hcmlvIE1ha2VyIGF1dGggcmVxdWVzdCBmYWlsZWQuJ1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICAgICAgYm9keTogX3N0cmluZ2lmeVF1ZXJ5KE9iamVjdC5hc3NpZ24ocXVlcnksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmc6IHRoaXMuX2xhbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBuaW50ZW5kb19hdXRoZW50aWNhdGU6ICcnLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNhbWVsY2FzZVxuICAgICAgICAgICAgICAgICAgICAgICAgbmludGVuZG9fYXV0aG9yaXplOiAnJywgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZmVyZXI6IGF1dGhSZXNwb25zZS5oZWFkZXJzLmxvY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgaG9zdG5hbWU6IGxvY2F0aW9uLmhvc3RuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBsb2NhdGlvbi5wYXRobmFtZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzZW5kU2Vzc2lvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVNlc3Npb246IGZhbHNlXG4gICAgICAgICAgICAgICAgfSwgKGVycm9yLCBsb2dJblJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbihfRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAobG9nSW5SZXNwb25zZS5zdGF0dXNDb2RlICE9PSAzMDMgfHwgdHlwZW9mIGxvZ0luUmVzcG9uc2UuaGVhZGVycy5sb2NhdGlvbiAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24oX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlOiBsb2dJblJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU3VwZXIgTWFyaW8gTWFrZXIgbG9nIGluIGZhaWxlZC4nXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZmVyZXI6IGF1dGhSZXNwb25zZS5oZWFkZXJzLmxvY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRTZXNzaW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU2Vzc2lvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogbG9nSW5SZXNwb25zZS5oZWFkZXJzLmxvY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24oX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0xvZ2dlZEluID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgQG1ldGhvZCBtb2R1bGU6c3VwZXItbWFyaW8tbWFrZXItY2xpZW50flN1cGVyTWFyaW9NYWtlckNsaWVudCNsb2dPdXRcbiAgICAgICAgQHJldHVybnMge3RoaXN9XG4gICAgICAgICovXG4gICAgICAgIGxvZ091dCAoKSB7XG4gICAgICAgICAgICB0aGlzLl9pc0xvZ2dlZEluID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9zZXNzaW9uID0gJyc7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgIEBtZXRob2QgbW9kdWxlOnN1cGVyLW1hcmlvLW1ha2VyLWNsaWVudH5TdXBlck1hcmlvTWFrZXJDbGllbnQjdW5ib29rbWFya0NvdXJzZVxuICAgICAgICBAYXJnIHtPYmplY3R9IGNvbmZpZ1xuICAgICAgICBAYXJnIHtTdHJpbmd9IGNvbmZpZy5jb3Vyc2VJZFxuICAgICAgICBAYXJnIHtTdHJpbmd9IGNvbmZpZy5jc3JmVG9rZW5cbiAgICAgICAgQGFyZyB7RXJyb3JDYWxsYmFja30gY2FsbGJhY2tGdW5jdGlvblxuICAgICAgICBAaW5zdGFuY2VcbiAgICAgICAgQHJldHVybnMge3RoaXN9XG4gICAgICAgICovXG4gICAgICAgIHVuYm9va21hcmtDb3Vyc2UgKHtcbiAgICAgICAgICAgIGNvdXJzZUlkLFxuICAgICAgICAgICAgY3NyZlRva2VuXG4gICAgICAgIH0sIGNhbGxiYWNrRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5faXNMb2dnZWRJbikge1xuICAgICAgICAgICAgICAgIHNldEltbWVkaWF0ZShjYWxsYmFja0Z1bmN0aW9uLCBfRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnTm90IGxvZ2dlZCBpbi4nXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBbdGhpcy5fY3NyZlRva2VuSGVhZGVyTmFtZV06IGNzcmZUb2tlblxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuX2dldENvdXJzZVVuYm9va21hcmtVcmwoY291cnNlSWQpXG4gICAgICAgICAgICB9LCAoZXJyb3IsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24oX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDIwMCB8fCByZXNwb25zZS5zdGF0dXNDb2RlID09PSAzMDIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24oX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdW5ib29rbWFyayBjb3Vyc2UuJ1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICBAbWV0aG9kIG1vZHVsZTpzdXBlci1tYXJpby1tYWtlci1jbGllbnR+U3VwZXJNYXJpb01ha2VyQ2xpZW50I19nZXRDb3Vyc2VCb29rbWFya1VybFxuICAgICAgICBAYXJnIHtTdHJpbmd9IGNvdXJzZUlkXG4gICAgICAgIEBwcm90ZWN0ZWRcbiAgICAgICAgQHJldHVybnMge1N0cmluZ31cbiAgICAgICAgKi9cbiAgICAgICAgX2dldENvdXJzZUJvb2ttYXJrVXJsIChjb3Vyc2VJZCkge1xuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMuX2dldENvdXJzZVVybChjb3Vyc2VJZCl9L3BsYXlfYXRfbGF0ZXJgO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgQG1ldGhvZCBtb2R1bGU6c3VwZXItbWFyaW8tbWFrZXItY2xpZW50flN1cGVyTWFyaW9NYWtlckNsaWVudCNfZ2V0Q291cnNlVW5ib29rbWFya1VybFxuICAgICAgICBAYXJnIHtTdHJpbmd9IGNvdXJzZUlkXG4gICAgICAgIEBwcm90ZWN0ZWRcbiAgICAgICAgQHJldHVybnMge1N0cmluZ31cbiAgICAgICAgKi9cbiAgICAgICAgX2dldENvdXJzZVVuYm9va21hcmtVcmwgKGNvdXJzZUlkKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5fc3VwZXJNYXJpb01ha2VyQm9va21hcmtVcmx9L2Jvb2ttYXJrcy8ke2NvdXJzZUlkfWA7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICBAbWV0aG9kIG1vZHVsZTpzdXBlci1tYXJpby1tYWtlci1jbGllbnR+U3VwZXJNYXJpb01ha2VyQ2xpZW50I19nZXRDb3Vyc2VVcmxcbiAgICAgICAgQGFyZyB7U3RyaW5nfSBjb3Vyc2VJZFxuICAgICAgICBAcHJvdGVjdGVkXG4gICAgICAgIEByZXR1cm5zIHtTdHJpbmd9XG4gICAgICAgICovXG4gICAgICAgIF9nZXRDb3Vyc2VVcmwgKGNvdXJzZUlkKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5fc3VwZXJNYXJpb01ha2VyQm9va21hcmtVcmx9L2NvdXJzZXMvJHtjb3Vyc2VJZH1gO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgQG1ldGhvZCBtb2R1bGU6c3VwZXItbWFyaW8tbWFrZXItY2xpZW50flN1cGVyTWFyaW9NYWtlckNsaWVudCNfaW5pdFxuICAgICAgICBAYXJnIHtPYmplY3R9IGNvbmZpZ1xuICAgICAgICBAcHJvdGVjdGVkXG4gICAgICAgIEByZXR1cm5zIHt0aGlzfVxuICAgICAgICAqL1xuICAgICAgICBfaW5pdCAoe1xuICAgICAgICAgICAgY3NyZlRva2VuSGVhZGVyTmFtZSA9ICdYLUNTUkYtVG9rZW4nLFxuICAgICAgICAgICAgZ2FtZVN0eWxlcyA9IHtcbiAgICAgICAgICAgICAgICBzYjogJ3N1cGVyTWFyaW9Ccm9zJyxcbiAgICAgICAgICAgICAgICBzYjM6ICdzdXBlck1hcmlvQnJvczMnLFxuICAgICAgICAgICAgICAgIHNidTogJ25ld1N1cGVyTWFyaW9Ccm9zVScsXG4gICAgICAgICAgICAgICAgc3c6ICdzdXBlck1hcmlvV29ybGQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGFuZyA9ICdlbi1VUycsXG4gICAgICAgICAgICBzZXNzaW9uQ29va2llTmFtZSA9ICdfc3VwZXJtYXJpb21ha2VyYm9va21hcmtfc2Vzc2lvbicsXG4gICAgICAgICAgICBzdXBlck1hcmlvTWFrZXJBdXRoVXJsID0gJ2h0dHBzOi8vc3VwZXJtYXJpb21ha2VyYm9va21hcmsubmludGVuZG8ubmV0L3VzZXJzL2F1dGgvbmludGVuZG8nLFxuICAgICAgICAgICAgc3VwZXJNYXJpb01ha2VyQm9va21hcmtVcmwgPSAnaHR0cHM6Ly9zdXBlcm1hcmlvbWFrZXJib29rbWFyay5uaW50ZW5kby5uZXQnXG4gICAgICAgIH0gPSB7fSkge1xuICAgICAgICAgICAgdGhpcy5fY3NyZlRva2VuSGVhZGVyTmFtZSA9IGNzcmZUb2tlbkhlYWRlck5hbWU7XG4gICAgICAgICAgICB0aGlzLl9nYW1lU3R5bGVzID0gZ2FtZVN0eWxlcztcbiAgICAgICAgICAgIHRoaXMuX2lzTG9nZ2VkSW4gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX2xhbmcgPSBsYW5nO1xuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdEluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RRdWV1ZSA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fc2Vzc2lvbiA9ICcnO1xuICAgICAgICAgICAgdGhpcy5fc2Vzc2lvbkNvb2tpZU5hbWUgPSBzZXNzaW9uQ29va2llTmFtZTtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyTWFyaW9NYWtlckF1dGhVcmwgPSBzdXBlck1hcmlvTWFrZXJBdXRoVXJsO1xuICAgICAgICAgICAgdGhpcy5fc3VwZXJNYXJpb01ha2VyQm9va21hcmtVcmwgPSBzdXBlck1hcmlvTWFrZXJCb29rbWFya1VybDtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgQG1ldGhvZCBtb2R1bGU6c3VwZXItbWFyaW8tbWFrZXItY2xpZW50flN1cGVyTWFyaW9NYWtlckNsaWVudCNfcmVxdWVzdFxuICAgICAgICBAYXJnIHtPYmplY3R9IGNvbmZpZ1xuICAgICAgICBAYXJnIHtTdHJpbmd9IFtjb25maWcuYm9keV1cbiAgICAgICAgQGFyZyB7T2JqZWN0fSBbY29uZmlnLm9wdGlvbnM9e31dXG4gICAgICAgIEBhcmcge0Jvb2xlYW59IFtjb25maWcuc2VuZFNlc3Npb25dXG4gICAgICAgIEBhcmcge0Jvb2xlYW59IFtjb25maWcudXBkYXRlU2Vzc2lvbl1cbiAgICAgICAgQGFyZyB7U3RyaW5nfSBbY29uZmlnLnVybF1cbiAgICAgICAgQGFyZyB7SW5jb21pbmdNZXNzYWdlQ2FsbGJhY2t9IGNhbGxiYWNrRnVuY3Rpb25cbiAgICAgICAgQHByb3RlY3RlZFxuICAgICAgICBAcmV0dXJucyB7dGhpc31cbiAgICAgICAgKi9cbiAgICAgICAgX3JlcXVlc3QgKHtcbiAgICAgICAgICAgIGJvZHksXG4gICAgICAgICAgICBvcHRpb25zID0ge30sXG4gICAgICAgICAgICBzZW5kU2Vzc2lvbixcbiAgICAgICAgICAgIHVwZGF0ZVNlc3Npb24sXG4gICAgICAgICAgICB1cmxcbiAgICAgICAgfSwgY2FsbGJhY2tGdW5jdGlvbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3JlcXVlc3RJblByb2dyZXNzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdFF1ZXVlLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja0Z1bmN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgICAgICAgICB1cmxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0SW5Qcm9ncmVzcyA9IHRydWU7XG5cbiAgICAgICAgICAgIGxldCBjb21wbGV0ZTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZW5kU2Vzc2lvbiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBzZW5kU2Vzc2lvbiA9IHRoaXMuX2lzTG9nZ2VkSW47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdXBkYXRlU2Vzc2lvbiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVTZXNzaW9uID0gdGhpcy5faXNMb2dnZWRJbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbmRTZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgbGV0IGhlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWhlYWRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmhlYWRlcnMgPSBoZWFkZXJzO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChoZWFkZXJzLkNvb2tpZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV3IFJlZ0V4cChgJHt0aGlzLl9zZXNzaW9uQ29va2llTmFtZX09Lio/KD86O3wkKWApLnRlc3QoaGVhZGVycy5Db29raWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzLkNvb2tpZSA9IGhlYWRlcnMuQ29va2llLnJlcGxhY2UobmV3IFJlZ0V4cChgJHt0aGlzLl9zZXNzaW9uQ29va2llTmFtZX09Lio/KDt8JClgKSwgYCR7dGhpcy5fc2Vzc2lvbkNvb2tpZU5hbWV9PSR7dGhpcy5fc2Vzc2lvbn0kMWApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycy5Db29raWUgKz0gYDsgJHt0aGlzLl9zZXNzaW9uQ29va2llTmFtZX09JHt0aGlzLl9zZXNzaW9ufWA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzLkNvb2tpZSA9IGAke3RoaXMuX3Nlc3Npb25Db29raWVOYW1lfT0ke3RoaXMuX3Nlc3Npb259YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlRnVuY3Rpb24gPSAoZXJyb3IsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdEluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbihfRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZFNlc3Npb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVNlc3Npb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1JlcXVlc3QgZXJyb3IuJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbihudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gdGhpcy5fcmVxdWVzdFF1ZXVlLnNoaWZ0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3QobmV4dCwgbmV4dC5jYWxsYmFja0Z1bmN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IF9yZXF1ZXN0KHVybCA/IE9iamVjdC5hc3NpZ24oX3BhcnNlVXJsKHVybCksIG9wdGlvbnMpIDogb3B0aW9ucywgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXVwZGF0ZVNlc3Npb24gfHwgQXJyYXkuaXNBcnJheShyZXNwb25zZS5oZWFkZXJzWydzZXQtY29va2llJ10pICYmIHJlc3BvbnNlLmhlYWRlcnNbJ3NldC1jb29raWUnXS5zb21lKGNvb2tpZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IGNvb2tpZS5tYXRjaChuZXcgUmVnRXhwKGAke3RoaXMuX3Nlc3Npb25Db29raWVOYW1lfT0oLio/KTtgKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nlc3Npb24gPSBtYXRjaFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVGdW5jdGlvbihudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZUZ1bmN0aW9uKF9FcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgc2Vzc2lvbi4nXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmVxdWVzdC5vbignZXJyb3InLCBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgY29tcGxldGVGdW5jdGlvbihfRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBlcnJvclxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXF1ZXN0LmVuZChib2R5KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICB9KSxcblxuICAgIC8qKlxuICAgIEBmdW5jdGlvbiBmZXRjaENvdXJzZVxuICAgIEBhcmcge1N0cmluZ30gY291cnNlSWRcbiAgICBAYXJnIHtDb3Vyc2VDYWxsYmFja30gY2FsbGJhY2tGdW5jdGlvblxuICAgICovXG4gICAgX2ZldGNoQ291cnNlID0gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICAgICAgUmVmbGVjdC5hcHBseShfU3VwZXJNYXJpb01ha2VyQ2xpZW50LnByb3RvdHlwZS5mZXRjaENvdXJzZSwgX1N1cGVyTWFyaW9NYWtlckNsaWVudCgpLCBhcmdzKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgQGZ1bmN0aW9uIGxvZ0luXG4gICAgQGFyZyB7T2JqZWN0fSBjb25maWdcbiAgICBAYXJnIHtTdHJpbmd9IGNvbmZpZy5wYXNzd29yZFxuICAgIEBhcmcge1N0cmluZ30gY29uZmlnLnVzZXJuYW1lXG4gICAgQGFyZyB7U3VwZXJNYXJpb01ha2VyQ2xpZW50Q2FsbGJhY2t9IGNhbGxiYWNrRnVuY3Rpb25cbiAgICAqL1xuICAgIF9sb2dJbiA9IGZ1bmN0aW9uIChjb25maWcsIGNhbGxiYWNrRnVuY3Rpb24pIHtcbiAgICAgICAgY29uc3Qgc3VwZXJNYXJpb01ha2VyQ2xpZW50ID0gX1N1cGVyTWFyaW9NYWtlckNsaWVudCgpLmxvZ0luKGNvbmZpZywgZXJyb3IgPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbihfRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBlcnJvclxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbihudWxsLCBzdXBlck1hcmlvTWFrZXJDbGllbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG5leHBvcnQge1xuICAgIF9mZXRjaENvdXJzZSBhcyBmZXRjaENvdXJzZSxcbiAgICBfbG9nSW4gYXMgbG9nSW4sXG4gICAgX1N1cGVyTWFyaW9NYWtlckNsaWVudCBhcyBkZWZhdWx0XG59O1xuIl19