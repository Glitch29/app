<html>

	<style>

		#consoles{
			margin-top: 1%;
			float: left;
			z-index: 10;
			position: absolute;
			display: block;
			background-color: lightgrey;
			width: 20%;
			font-size: 200%;
			box-shadow: 0px 0 5px black;
		}
		#games{
			margin-top: 1%;
			float: right;
			position: relative;
			display: inline-block;
			width: 80%;
			background-color: white;
			color: black;
			height: 100%;
			font-size: 200%;
		}
		.selected{
			color: black;
			background-color: white;
		}
		span{
			color: black;
			text-decoration: none
		}
		.DONE{
			text-decoration: underline;
			color: green;
		}
		.BLIND{
			text-decoration: underline;
			color: red;
		}
		.SEMI-BLIND{
			text-decoration: underline;
			color: orange;
		}
		.game{
			width: 70%;
			margin-left: 10px;
			padding-left: 10px;
			box-shadow: 0px 0 5px black;
		}
		#legend{
			z-index: 5;
			background-color: white;
			position: fixed;
			display: inline-block;
			font-size: 4vh;
			width: 50%;
			left: 25%;
			height: 5%;
			bottom: 0%;
			box-shadow: 0px 0 5px black;
		}
		.legend-text{
			width: 33%;
			text-align: center;
			position: relative;
			float: left;
			display: inline-block;

		}
		#tab-bar{
			position: relative;
			width: 70%;
			height: 7%;
			left: 15%;
			box-shadow: 0px 0 5px black;
		}
		#tab-bar .tab{

			display: inline-block;
			float: left;
			width: 33.33%;
			font-size: 4vh;
			padding-top: 1%;
			height: 100%;
			text-align: center;

			box-shadow: 0px 0 5px green;
		
		}
		.selected-tab{
			background-color: grey;
		}
	</style>
	<head>
		<% include ../partials/head %>
	</head>
	
	<% include ../partials/stream_top-bar %>
	<div id="tab-bar">
		<p id='All' class="tab">All</p>
		<p id='Completed' class="tab">Completed</p>
		<p id="Incomplete" class="tab">Incomplete</p>
	</div>
	<div id="consoles"></div>
	<div id="games"></div>
	<div id="legend">
		<div class="DONE legend-text"><span>Re-clear</span></div>
		<div class="SEMI-BLIND legend-text"><span>Semi-Blind</span></div>
		<div class="BLIND legend-text"><span>Blind</span></div>
	</div>


	<script>
		$(document).ready(function(){
			var selectedConsole;
			
			var tab = "All";
			var consoles = <%- JSON.stringify(consoles) %>
			var allGames = [];
			var completedGames = [];
			var incompleteGames = [];
			selectTab("All");
			function selectTab(set_tab){
				tab = set_tab;
				$('.tab').each(function (item){
					$(this).removeClass('selected-tab');
				});
				$('#'+tab).addClass('selected-tab');

				showTab(tab);
			}

			$('.tab').click(function (item){
				var new_tab = $(this).text();
				selectTab(new_tab);
			});
			for (var console in consoles){
				$('#consoles').append('<p>'+consoles[console]+"</p>");
			}
			$('#consoles').on('click','p',function(){

				var clickedConsole = $(this);
				if (clickedConsole == selectedConsole){

				}
				else{
					if (selectedConsole){
						selectedConsole.removeClass('selected');
					}
					selectedConsole = clickedConsole
					clickedConsole.addClass('selected');
					$.ajax({
					type: "POST",
					url: "../stream/request/gameslist",
					data: {console: clickedConsole.text()},
					success: function(msg){
						request = msg['request'];
						if (request == "success"){
							var games = msg['games'];
							allGames = [];
							completedGames = [];
							incompleteGames = [];
							for (var game in games){
								allGames.push(games[game]);
								if (games[game].completed != undefined){
									completedGames.push(games[game]);
								}
								else{
									incompleteGames.push(games[game]);
								}
								
							}
							showTab(tab);
						}
						else{
							alert(msg['error']);
						}
					}
					});
				}

			});
			function showTab(tab){
				$('#games').empty();
				
				var games = [];
				if (tab == "All"){
					games = allGames;
				}
				if (tab == "Completed"){
					games = completedGames;
				}
				if (tab == "Incomplete"){
			
					games = incompleteGames;
				}
				for (var i = 0; i < games.length; i++){
					$('#games').append('<div class="game"><p class='+games[i].experience+'><span>'+games[i].game+"</span></p></div>");
				}
			}
		});
	</script>
</html>