<html>
	<head>
		<script  src="https://code.jquery.com/jquery-3.1.0.min.js"   integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="   crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	</head>
	<style>
		.input-new-item{
			width: 500px;
		}
		.red{
			background-color: red;
		}
		.green{
			background-color: green;
		}
		.title{
			font-size: 125%;

		}
		.text{
			font-size: 75%;

		}
	</style>

	<br><br><br>

	<% for(var i=0; i<json.access.length; i++) {

		%>
			<label class="checkbox-inline"><input type="checkbox" onclick=clickRadio(this) id="<%= json.access[i] %>" value=<%= json.access[i]  %>><%= json.access[i] %></label>
		 <% } %>
 	<br><br>
	<% for(var i=0; i<json.content.length; i++) {
	var checklist = [];
	var checked = false;
	var title = json.content[i].title
	if (json.content[i].checked.indexOf(email) >= 0){
		checked = true;
	}
	checklist.push(JSON.stringify(json.content[i].checked))
	%>
	<ul class="list-group">
		 <li class="content list-group-item" check_list= <%= checklist %>   data-toggle="tooltip" data-placement="bottom" title="<%=json.content[i].checked %>" >
		 	<div style="display: inline-block;">
		 		<div class="title">
		 			<%=json.content[i].title %> <br>
		 		</div>
		 		<div class="text">
		 			<%=json.content[i].text %>
		 		</div>
		 	</div>
			<div style="display: inline-block;">

			  	<% if (checked == false){ %>
				    <button class="btn btn-default green" onclick=approve("<%- encodeURIComponent(json.content[i].title)%>")>Approve</button>
				<% } else { %>
			  		<button class="btn btn-default red" onclick=decline("<%- encodeURIComponent(json.content[i].title)%>")>Decline</button>
			  	<% } %>
			    <button class="btn btn-default" onclick=remove("<%-encodeURIComponent(json.content[i].title)%>")>Remove</button>
		    </div>

		 </li>
	 </ul>
	<% } %>
	<div class="input-new-item">
		<input type="text" class="form-control" id="title" placeholder="Title"/>
		<input type="text" class="form-control" id="text" placeholder="Comment"/>
		<button id="create" class="btn btn-default">Create</button>
	</div>
	<script>
		var filter_list = [];
		var list;
		$(document).ready(function(){
			$(function () {
				$('[data-toggle="tooltip"]').tooltip()
			})

			list = "<%= list %>"
			
			$('#create').click(function(){
				$.ajax({
					type: "POST",
					url: "/lists/request/add",
					data: {title: $('#title').val(), text: $('#text').val(), list: list},
					success: function(msg){
						request = msg['request'];
						if (request == "success"){
							//$('#list').append($('<li id="list:'+$('#title').val()+'"><span class="item-text">'+$('#title').val()+'</span>'));
							//$('#title').val('')
							location.reload();
						}
						else{
							alert(msg['error']);
						}
					}
				});
			});

		});

		function clickRadio(user){
			username=user.getAttribute("value");
			
			if (user.checked == false){
				var index = filter_list.indexOf(username);
				if (index > -1){
					filter_list.splice(index,1);
				}

			}
			else{
				filter_list.push(username);
			}
			

			$(".content").each(function() {
				var checked = JSON.parse(($( this ).attr('check_list')));


				$(this).show();
				for (var filter = 0; filter<filter_list.length; filter++ ){
					
					if (checked.indexOf(filter_list[filter]) < 0){
						$(this).hide();
						break;
					}
				}
			});
		}

		function approve(title){
			title = decodeURIComponent(title);
			$.ajax({
				type: "POST",
				url: "/lists/request/approve",
				data: {title: title, list: list},
				success: function(msg){
					request = msg['request'];
					if (request == "success"){
						//$('#list').append($('<li id="list:'+$('#title').val()+'"><span class="item-text">'+$('#title').val()+'</span>'));
						//$('#title').val('')
						location.reload();
					}
					else{
						alert(msg['error']);
					}
				}
			});
		}
		

		function decline(title){
			title = decodeURIComponent(title);
			$.ajax({
				type: "POST",
				url: "/lists/request/decline",
				data: {title: title, list: list},
				success: function(msg){
					request = msg['request'];
					if (request == "success"){
						//$('#list').append($('<li id="list:'+$('#title').val()+'"><span class="item-text">'+$('#title').val()+'</span>'));
						//$('#title').val('')
						location.reload();
					}
					else{
						alert(msg['error']);
					}
				}
			});
		}

		function remove(title){
			title = decodeURIComponent(title);
			$.ajax({
				type: "POST",
				url: "/lists/request/remove",
				data: {title: title, list: list},
				success: function(msg){
					request = msg['request'];
					if (request == "success"){
						//$('#list').append($('<li id="list:'+$('#title').val()+'"><span class="item-text">'+$('#title').val()+'</span>'));
						//$('#title').val('')
						location.reload();
					}
					else{
						alert(msg['error']);
					}
				}
			});
		}
	</script>
</html>